# æ•°æ®åº“å­—æ®µæ›´æ–°è¯´æ˜

## æ›´æ–°å†…å®¹

ä¸º `xianyu_goods_info` è¡¨æ·»åŠ  `detail_url` å­—æ®µã€‚

## æ›´æ–°åŸå› 

åœ¨åˆ·æ–°å•†å“åˆ—è¡¨æ—¶ï¼Œéœ€è¦ä¿å­˜å•†å“è¯¦æƒ…é¡µçš„URLï¼Œä»¥ä¾¿åç»­å¯ä»¥ç›´æ¥è®¿é—®å•†å“è¯¦æƒ…é¡µæˆ–ç”¨äºå…¶ä»–åŠŸèƒ½ã€‚

## å­—æ®µå®šä¹‰

```sql
ALTER TABLE xianyu_goods_info ADD COLUMN detail_url TEXT;
```

**å­—æ®µè¯´æ˜ï¼š**
- å­—æ®µåï¼š`detail_url`
- å­—æ®µç±»å‹ï¼š`TEXT`
- å­—æ®µç”¨é€”ï¼šå­˜å‚¨å•†å“è¯¦æƒ…é¡µçš„URLï¼ˆå¦‚ï¼š`https://www.goofish.com/item?id=123456789`ï¼‰
- å¡«å……æ—¶æœºï¼šåœ¨è°ƒç”¨ `/api/items/refresh` åˆ·æ–°å•†å“åˆ—è¡¨æ—¶è‡ªåŠ¨ä¿å­˜

## è‡ªåŠ¨è¿ç§»

ç³»ç»Ÿå·²é…ç½®è‡ªåŠ¨æ•°æ®åº“è¿ç§»åŠŸèƒ½ï¼Œå¯åŠ¨åº”ç”¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ·»åŠ ç¼ºå¤±çš„å­—æ®µã€‚

**è¿ç§»é€»è¾‘ä½ç½®ï¼š**
- `DatabaseInitListener.java` - æ•°æ®åº“åˆå§‹åŒ–ç›‘å¬å™¨
- åœ¨ `checkAndAddColumns()` æ–¹æ³•ä¸­æ·»åŠ äº† `detail_url` å­—æ®µçš„æ£€æŸ¥å’Œåˆ›å»ºé€»è¾‘

## æ‰‹åŠ¨è¿ç§»ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ‰‹åŠ¨æ‰§è¡Œè¿ç§»ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹SQLï¼š

```sql
-- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
PRAGMA table_info(xianyu_goods_info);

-- å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ å­—æ®µ
ALTER TABLE xianyu_goods_info ADD COLUMN detail_url TEXT;
```

## å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶

1. **æ•°æ®åº“è¡¨ç»“æ„**
   - `src/main/resources/sql/schema.sql` - æ·»åŠ  `detail_url` å­—æ®µå®šä¹‰

2. **å®ä½“ç±»**
   - `src/main/java/com/feijimiao/xianyuassistant/entity/XianyuGoodsInfo.java` - æ·»åŠ  `detailUrl` å±æ€§

3. **æœåŠ¡å®ç°**
   - `src/main/java/com/feijimiao/xianyuassistant/service/impl/GoodsInfoServiceImpl.java` - åœ¨ä¿å­˜å•†å“æ—¶æ·»åŠ  `detailUrl` å­—æ®µçš„èµ‹å€¼

4. **æ•°æ®åº“åˆå§‹åŒ–**
   - `src/main/java/com/feijimiao/xianyuassistant/config/DatabaseInitListener.java` - æ·»åŠ è‡ªåŠ¨è¿ç§»é€»è¾‘

### æ–°å¢çš„æ–‡ä»¶

1. `src/main/resources/sql/migration_add_detail_url.sql` - æ‰‹åŠ¨è¿ç§»è„šæœ¬ï¼ˆå¯é€‰ï¼‰

## éªŒè¯æ–¹æ³•

å¯åŠ¨åº”ç”¨åï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```
ğŸ” æ£€æŸ¥è¡¨å­—æ®µ...
  â• æ·»åŠ å­—æ®µ: xianyu_goods_info.detail_url
âœ… æ·»åŠ äº† 1 ä¸ªæ–°å­—æ®µ
```

æˆ–è€…ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼š

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
PRAGMA table_info(xianyu_goods_info);

-- æŸ¥çœ‹æ•°æ®
SELECT xy_good_id, title, detail_url FROM xianyu_goods_info LIMIT 5;
```

## ä½¿ç”¨ç¤ºä¾‹

åˆ·æ–°å•†å“åˆ—è¡¨åï¼Œ`detail_url` å­—æ®µä¼šè‡ªåŠ¨å¡«å……ï¼š

```json
{
  "id": 123456789,
  "xyGoodId": "123456789",
  "title": "å•†å“æ ‡é¢˜",
  "detailUrl": "https://www.goofish.com/item?id=123456789",
  "coverPic": "//gw.alicdn.com/...",
  "soldPrice": "99.00",
  "status": 0
}
```

## æ³¨æ„äº‹é¡¹

1. **è‡ªåŠ¨è¿ç§»**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ·»åŠ ç¼ºå¤±çš„å­—æ®µï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
2. **æ•°æ®å…¼å®¹**ï¼šå·²æœ‰æ•°æ®çš„ `detail_url` å­—æ®µä¼šæ˜¯ `NULL`ï¼Œä¸‹æ¬¡åˆ·æ–°æ—¶ä¼šè‡ªåŠ¨å¡«å……
3. **æ— éœ€é‡å»ºè¡¨**ï¼šä½¿ç”¨ `ALTER TABLE` æ·»åŠ å­—æ®µï¼Œä¸ä¼šå½±å“ç°æœ‰æ•°æ®
4. **å¹‚ç­‰æ€§**ï¼šè¿ç§»é€»è¾‘æ˜¯å¹‚ç­‰çš„ï¼Œå¤šæ¬¡æ‰§è¡Œä¸ä¼šå‡ºé”™

## æ›´æ–°æ—¶é—´

2024-11-12
