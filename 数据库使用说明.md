# æ•°æ®åº“ä½¿ç”¨è¯´æ˜

## ğŸ“Š æ•°æ®åº“æ¦‚è¿°

ç³»ç»Ÿä½¿ç”¨SQLiteæ•°æ®åº“å­˜å‚¨é—²é±¼è´¦å·å’ŒCookieä¿¡æ¯ï¼Œæ•°æ®åº“æ–‡ä»¶ï¼š`xianyu_assistant.db`

## ğŸ—‚ï¸ è¡¨ç»“æ„

### 1. xianyu_accountï¼ˆé—²é±¼è´¦å·è¡¨ï¼‰

å­˜å‚¨é—²é±¼è´¦å·çš„åŸºæœ¬ä¿¡æ¯ã€‚

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | å¤‡æ³¨ |
|--------|------|------|------|
| id | INTEGER | ä¸»é”®ID | è‡ªå¢ |
| account_note | VARCHAR(100) | è´¦å·å¤‡æ³¨ | ç”¨æˆ·è‡ªå®šä¹‰çš„è´¦å·åç§° |
| unb | VARCHAR(100) | UNBæ ‡è¯† | é—²é±¼è´¦å·çš„å”¯ä¸€æ ‡è¯† |
| status | TINYINT | è´¦å·çŠ¶æ€ | 1:æ­£å¸¸ -1:éœ€è¦æ‰‹æœºå·éªŒè¯ |
| created_time | DATETIME | åˆ›å»ºæ—¶é—´ | è‡ªåŠ¨ç”Ÿæˆ |
| updated_time | DATETIME | æ›´æ–°æ—¶é—´ | è‡ªåŠ¨æ›´æ–° |

**ç´¢å¼•**ï¼š
- `idx_account_unb`: å¯¹unbå­—æ®µå»ºç«‹ç´¢å¼•ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦

### 2. xianyu_cookieï¼ˆé—²é±¼Cookieè¡¨ï¼‰

å­˜å‚¨é—²é±¼è´¦å·çš„Cookieä¿¡æ¯ã€‚

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | å¤‡æ³¨ |
|--------|------|------|------|
| id | INTEGER | ä¸»é”®ID | è‡ªå¢ |
| xianyu_account_id | BIGINT | å…³è”çš„è´¦å·ID | å¤–é”®å…³è”xianyu_account.id |
| cookie_text | TEXT | Cookieå­—ç¬¦ä¸² | å®Œæ•´çš„Cookieå†…å®¹ |
| cookie_status | TINYINT | CookieçŠ¶æ€ | 1:æœ‰æ•ˆ 2:è¿‡æœŸ 3:å¤±æ•ˆ |
| expire_time | DATETIME | è¿‡æœŸæ—¶é—´ | é»˜è®¤30å¤©åè¿‡æœŸ |
| created_time | DATETIME | åˆ›å»ºæ—¶é—´ | è‡ªåŠ¨ç”Ÿæˆ |
| updated_time | DATETIME | æ›´æ–°æ—¶é—´ | è‡ªåŠ¨æ›´æ–° |

**ç´¢å¼•**ï¼š
- `idx_cookie_account_id`: å¯¹xianyu_account_idå­—æ®µå»ºç«‹ç´¢å¼•
- `idx_cookie_status`: å¯¹cookie_statuså­—æ®µå»ºç«‹ç´¢å¼•

**å¤–é”®çº¦æŸ**ï¼š
- `xianyu_account_id` å…³è” `xianyu_account(id)`

## ğŸ”„ è‡ªåŠ¨åˆå§‹åŒ–

### å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º

åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ•°æ®åº“
3. æ‰§è¡Œ `schema.sql` è„šæœ¬åˆ›å»ºè¡¨ç»“æ„
4. åˆ›å»ºç´¢å¼•å’Œè§¦å‘å™¨
5. éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ

### æ—¥å¿—è¾“å‡º

å¯åŠ¨æ—¶ä¼šè¾“å‡ºæ•°æ®åº“ä¿¡æ¯ï¼š

```
============================================================
æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹éªŒè¯...
============================================================
ğŸ“Š æ•°æ®åº“è¡¨åˆ—è¡¨:
  âœ“ xianyu_account (è®°å½•æ•°: 0)
  âœ“ xianyu_cookie (è®°å½•æ•°: 0)
ğŸ“‘ æ•°æ®åº“ç´¢å¼•åˆ—è¡¨:
  âœ“ idx_account_unb
  âœ“ idx_cookie_account_id
  âœ“ idx_cookie_status
âš¡ æ•°æ®åº“è§¦å‘å™¨åˆ—è¡¨:
  âœ“ update_xianyu_account_time
  âœ“ update_xianyu_cookie_time
============================================================
âœ… æ•°æ®åº“éªŒè¯å®Œæˆï¼Œç³»ç»Ÿå°±ç»ªï¼
============================================================
```

## ğŸ’¾ æ•°æ®æµç¨‹

### æ‰«ç ç™»å½•æµç¨‹

```
1. ç”¨æˆ·æ‰«ç ç™»å½•
   â†“
2. è·å–Cookieå’ŒUNB
   â†“
3. æ£€æŸ¥è´¦å·æ˜¯å¦å­˜åœ¨ï¼ˆæ ¹æ®UNBï¼‰
   â†“
4. å¦‚æœå­˜åœ¨ï¼šæ›´æ–°è´¦å·ä¿¡æ¯å’ŒCookie
   å¦‚æœä¸å­˜åœ¨ï¼šåˆ›å»ºæ–°è´¦å·å’ŒCookie
   â†“
5. ä¿å­˜åˆ°æ•°æ®åº“
```

### å•†å“æŸ¥è¯¢æµç¨‹

```
1. ç”¨æˆ·è¾“å…¥Cookie IDï¼ˆè´¦å·å¤‡æ³¨æˆ–UNBï¼‰
   â†“
2. å…ˆæŒ‰è´¦å·å¤‡æ³¨æŸ¥è¯¢
   â†“
3. å¦‚æœæ²¡æ‰¾åˆ°ï¼ŒæŒ‰UNBæŸ¥è¯¢
   â†“
4. è·å–Cookieå­—ç¬¦ä¸²
   â†“
5. è°ƒç”¨é—²é±¼API
```

## ğŸ” æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢æ‰€æœ‰è´¦å·

```sql
SELECT 
    id,
    account_note,
    unb,
    status,
    created_time,
    updated_time
FROM xianyu_account
ORDER BY created_time DESC;
```

### æŸ¥è¯¢è´¦å·çš„Cookie

```sql
SELECT 
    a.account_note,
    a.unb,
    c.cookie_text,
    c.cookie_status,
    c.expire_time
FROM xianyu_account a
LEFT JOIN xianyu_cookie c ON a.id = c.xianyu_account_id
WHERE a.account_note = 'è´¦å·_12345678';
```

### æŸ¥è¯¢æœ‰æ•ˆçš„Cookie

```sql
SELECT 
    a.account_note,
    a.unb,
    c.cookie_text,
    c.expire_time
FROM xianyu_account a
INNER JOIN xianyu_cookie c ON a.id = c.xianyu_account_id
WHERE c.cookie_status = 1
  AND c.expire_time > datetime('now')
ORDER BY c.created_time DESC;
```

### ç»Ÿè®¡è´¦å·æ•°é‡

```sql
SELECT 
    COUNT(*) as total_accounts,
    SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) as normal_accounts,
    SUM(CASE WHEN status = -1 THEN 1 ELSE 0 END) as verification_required
FROM xianyu_account;
```

## ğŸ› ï¸ ç»´æŠ¤æ“ä½œ

### æ¸…ç†è¿‡æœŸCookie

```sql
-- æ ‡è®°è¿‡æœŸçš„Cookie
UPDATE xianyu_cookie
SET cookie_status = 2
WHERE expire_time < datetime('now')
  AND cookie_status = 1;
```

### åˆ é™¤å¤±æ•ˆè´¦å·

```sql
-- åˆ é™¤Cookie
DELETE FROM xianyu_cookie
WHERE xianyu_account_id IN (
    SELECT id FROM xianyu_account WHERE status = -1
);

-- åˆ é™¤è´¦å·
DELETE FROM xianyu_account WHERE status = -1;
```

### æ›´æ–°Cookieè¿‡æœŸæ—¶é—´

```sql
UPDATE xianyu_cookie
SET expire_time = datetime('now', '+30 days'),
    updated_time = datetime('now')
WHERE id = 1;
```

## ğŸ“ ä½¿ç”¨å»ºè®®

### 1. Cookie ID å‘½åè§„èŒƒ

å»ºè®®ä½¿ç”¨æœ‰æ„ä¹‰çš„è´¦å·å¤‡æ³¨ï¼š
- âœ… `ä¸»è´¦å·`ã€`å¤‡ç”¨è´¦å·`
- âœ… `åº—é“ºA`ã€`åº—é“ºB`
- âœ… `æµ‹è¯•è´¦å·_001`
- âŒ é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦

### 2. å®šæœŸæ¸…ç†

å»ºè®®å®šæœŸæ¸…ç†ï¼š
- è¿‡æœŸçš„Cookieï¼ˆè¶…è¿‡30å¤©ï¼‰
- å¤±æ•ˆçš„è´¦å·ï¼ˆstatus = -1ï¼‰
- é•¿æœŸæœªä½¿ç”¨çš„è´¦å·

### 3. å¤‡ä»½æ•°æ®

é‡è¦æ•°æ®å»ºè®®å®šæœŸå¤‡ä»½ï¼š
```bash
# å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
cp xianyu_assistant.db xianyu_assistant_backup_$(date +%Y%m%d).db
```

### 4. å®‰å…¨å»ºè®®

- ğŸ”’ æ•°æ®åº“æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ³¨æ„æƒé™æ§åˆ¶
- ğŸ”’ ä¸è¦å°†æ•°æ®åº“æ–‡ä»¶ä¸Šä¼ åˆ°å…¬å…±ä»“åº“
- ğŸ”’ å®šæœŸæ›´æ–°Cookieï¼Œä¿æŒè´¦å·å®‰å…¨

## ğŸ”§ é…ç½®è¯´æ˜

### application.properties

```properties
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:sqlite:xianyu_assistant.db
spring.datasource.driver-class-name=org.sqlite.JDBC

# è¿æ¥æ± é…ç½®
spring.datasource.hikari.maximum-pool-size=1
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# MyBatis Plusé…ç½®
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.global-config.db-config.id-type=auto
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
**A**: åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º `xianyu_assistant.db`

### Q2: å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“å†…å®¹ï¼Ÿ
**A**: å¯ä»¥ä½¿ç”¨SQLiteå®¢æˆ·ç«¯å·¥å…·ï¼Œå¦‚ï¼š
- DB Browser for SQLite
- SQLiteStudio
- DBeaver

### Q3: æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. æ£€æŸ¥æ—¥å¿—è¾“å‡º
2. ç¡®è®¤SQLiteé©±åŠ¨æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æ–‡ä»¶æƒé™
4. åˆ é™¤æ•°æ®åº“æ–‡ä»¶é‡æ–°å¯åŠ¨

### Q4: Cookieä¿å­˜å¤±è´¥ï¼Ÿ
**A**:
1. æ£€æŸ¥æ‰«ç ç™»å½•æ˜¯å¦æˆåŠŸ
2. æŸ¥çœ‹åç«¯æ—¥å¿—
3. ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸
4. æ£€æŸ¥UNBæ˜¯å¦æ­£ç¡®è·å–

### Q5: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ
**A**:
```bash
# åœæ­¢åº”ç”¨
# åˆ é™¤æ•°æ®åº“æ–‡ä»¶
rm xianyu_assistant.db
# é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°æ•°æ®åº“
```

## ğŸ“Š æ•°æ®åº“å·¥å…·æ¨è

### 1. DB Browser for SQLite
- å®˜ç½‘ï¼šhttps://sqlitebrowser.org/
- ç‰¹ç‚¹ï¼šå…è´¹ã€å¼€æºã€è·¨å¹³å°
- åŠŸèƒ½ï¼šå¯è§†åŒ–æŸ¥è¯¢ã€ç¼–è¾‘ã€å¯¼å‡º

### 2. SQLiteStudio
- å®˜ç½‘ï¼šhttps://sqlitestudio.pl/
- ç‰¹ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§ã€æ’ä»¶ä¸°å¯Œ
- åŠŸèƒ½ï¼šSQLç¼–è¾‘å™¨ã€æ•°æ®å¯¼å…¥å¯¼å‡º

### 3. DBeaver
- å®˜ç½‘ï¼šhttps://dbeaver.io/
- ç‰¹ç‚¹ï¼šæ”¯æŒå¤šç§æ•°æ®åº“
- åŠŸèƒ½ï¼šä¸“ä¸šçš„æ•°æ®åº“ç®¡ç†å·¥å…·

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Cookie IDè¯´æ˜.md](Cookie IDè¯´æ˜.md)
- [æµ‹è¯•ä¸­å¿ƒä½¿ç”¨è¯´æ˜.md](æµ‹è¯•ä¸­å¿ƒä½¿ç”¨è¯´æ˜.md)
- [é—²é±¼æ‰«ç ç™»å½•ä½¿ç”¨è¯´æ˜.md](é—²é±¼æ‰«ç ç™»å½•ä½¿ç”¨è¯´æ˜.md)
- [å•†å“APIä½¿ç”¨è¯´æ˜.md](å•†å“APIä½¿ç”¨è¯´æ˜.md)
