# 连接管理页面优化说明

## 优化内容

### 1. 后端接口增强
**文件**: `src/main/java/com/feijimiao/xianyuassistant/controller/WebSocketController.java`

在 WebSocket 状态接口中新增返回字段：
- `websocketToken`: WebSocket Token 值
- `tokenExpireTime`: Token 过期时间戳（毫秒）

这些字段从 `xianyu_cookie` 表中读取并返回给前端。

### 2. 前端接口类型更新
**文件**: `vue-code/src/api/websocket.ts`

更新 `WebSocketStatus` 接口，添加新字段：
```typescript
export interface WebSocketStatus {
  xianyuAccountId: number;
  connected: boolean;
  status: string;
  cookieStatus?: number;      // Cookie状态 1:有效 2:过期 3:失效
  cookieText?: string;        // Cookie值
  websocketToken?: string;    // WebSocket Token
  tokenExpireTime?: number;   // Token过期时间戳（毫秒）
}
```

### 3. 连接状态卡片优化
**文件**: `vue-code/src/views/connection/index.vue`

#### 新增功能
1. **时间格式化**: 将时间戳转换为易读的日期时间格式
2. **Token状态判断**: 自动判断 Token 是否过期
3. **状态标签**: 为 Token 状态添加颜色标签（有效/已过期/未设置）

#### 布局优化
采用三列网格布局，将连接状态信息重新组织为三个独立卡片：

1. **连接信息卡片**
   - 账号ID
   - 连接状态（带状态标签）
   - 启动/断开连接按钮（根据连接状态动态显示）

2. **Cookie信息卡片**
   - Cookie状态（带颜色标签）
   - Cookie值（文本域显示）

3. **WebSocket Token卡片**
   - Token状态（带颜色标签，自动判断是否过期）
   - 过期时间（格式化显示）
   - Token值（文本域显示）

#### 样式优化
- 使用 CSS Grid 三列布局，卡片宽度自适应
- 每个卡片独立显示，信息更清晰
- 优化间距和字体大小，提升可读性
- 统一颜色方案，使用简洁的白色卡片设计
- 添加阴影效果，增强层次感
- 文本域使用等宽字体，便于查看长字符串

#### 响应式设计
- **宽屏（>1400px）**: 三列并排显示
- **中屏（1024px-1400px）**: 前两个卡片并排，第三个卡片占满一行
- **小屏（<1024px）**: 所有卡片单列垂直排列
- **移动端（<768px）**: 账号列表和状态面板垂直排列

## 效果展示

优化后的连接状态卡片具有以下特点：
- ✅ 三列网格布局，信息分类清晰，一目了然
- ✅ 卡片宽度自适应，充分利用屏幕空间
- ✅ 操作按钮集成在连接信息卡片中，操作更直观
- ✅ 右上角刷新按钮，方便快速刷新状态
- ✅ 布局简洁美观，视觉舒适
- ✅ Token状态自动判断，无需手动计算
- ✅ 时间显示友好，易于理解
- ✅ 完整的响应式设计，适配各种屏幕尺寸
- ✅ 移动端友好，自动切换为单列布局

## 使用说明

1. 在连接管理页面选择一个账号
2. 查看连接状态卡片中的三个信息区块
3. 在连接信息卡片中点击"启动连接"或"断开连接"按钮
4. 点击右上角的刷新按钮可手动刷新状态（状态每5秒自动刷新）
5. Token状态会自动显示为"有效"或"已过期"
6. 过期时间以本地时间格式显示
7. 可以复制 Cookie 和 Token 值用于调试

## 技术细节

### Token过期判断逻辑
```typescript
const isTokenExpired = (timestamp?: number) => {
  if (!timestamp) return false;
  return Date.now() > timestamp;
};
```

### 时间格式化
```typescript
const formatTimestamp = (timestamp?: number) => {
  if (!timestamp) return '未设置';
  const date = new Date(timestamp);
  return date.toLocaleString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
};
```

## 注意事项

1. Token过期时间戳使用毫秒单位
2. 所有字段都是可选的，未设置时会显示友好提示
3. 状态会每5秒自动刷新
4. 文本域为只读模式，防止误操作
