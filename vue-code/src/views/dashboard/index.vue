<script setup lang="ts">
import { ref } from 'vue';
import { useRouter } from 'vue-router';
import { useDashboard } from './useDashboard';

const router = useRouter();
const { loading, stats, loadStatistics } = useDashboard();

// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
loadStatistics();

// å½“å‰æ¿€æ´»çš„æ­¥éª¤
const activeStep = ref(0);

// å¿«é€Ÿå¼€å§‹æ­¥éª¤
const quickStartSteps = [
  {
    title: '1. æ·»åŠ é—²é±¼è´¦å·',
    icon: 'ğŸ‘¤',
    description: 'é€šè¿‡æ‰«ç ç™»å½•æ·»åŠ æ‚¨çš„é—²é±¼è´¦å·',
    route: '/accounts',
    details: [
      'ç‚¹å‡»å·¦ä¾§èœå•"é—²é±¼è´¦å·"',
      'ç‚¹å‡»"æ‰«ç ç™»å½•"æŒ‰é’®',
      'ä½¿ç”¨é—²é±¼APPæ‰«æäºŒç»´ç ',
      'ç­‰å¾…ç™»å½•æˆåŠŸï¼Œè´¦å·è‡ªåŠ¨æ·»åŠ '
    ]
  },
  {
    title: '2. å¯åŠ¨WebSocketè¿æ¥',
    icon: 'ğŸ”—',
    description: 'å»ºç«‹ä¸é—²é±¼æœåŠ¡å™¨çš„å®æ—¶è¿æ¥',
    route: '/connection',
    details: [
      'è¿›å…¥"è¿æ¥ç®¡ç†"é¡µé¢',
      'é€‰æ‹©è¦è¿æ¥çš„è´¦å·',
      'ç‚¹å‡»"å¯åŠ¨è¿æ¥"æŒ‰é’®',
      'ç­‰å¾…è¿æ¥æˆåŠŸï¼Œå¼€å§‹ç›‘å¬æ¶ˆæ¯'
    ]
  },
  {
    title: '3. åŒæ­¥å•†å“ä¿¡æ¯',
    icon: 'ğŸ“¦',
    description: 'è·å–æ‚¨çš„é—²é±¼å•†å“åˆ—è¡¨',
    route: '/goods',
    details: [
      'è¿›å…¥"å•†å“ç®¡ç†"é¡µé¢',
      'é€‰æ‹©å·²è¿æ¥çš„è´¦å·',
      'ç‚¹å‡»"åˆ·æ–°å•†å“"æŒ‰é’®',
      'ç­‰å¾…å•†å“åŒæ­¥å®Œæˆ'
    ]
  },
  {
    title: '4. é…ç½®è‡ªåŠ¨åŒ–åŠŸèƒ½',
    icon: 'ğŸ¤–',
    description: 'è®¾ç½®è‡ªåŠ¨å‘è´§å’Œè‡ªåŠ¨å›å¤',
    route: '/auto-delivery',
    details: [
      'åœ¨å•†å“åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡å•†å“',
      'å¼€å¯"è‡ªåŠ¨å‘è´§"æˆ–"è‡ªåŠ¨å›å¤"',
      'é…ç½®å‘è´§å†…å®¹æˆ–å›å¤è§„åˆ™',
      'ä¿å­˜é…ç½®ï¼Œè‡ªåŠ¨åŒ–å¼€å§‹å·¥ä½œ'
    ]
  }
];

// åŠŸèƒ½ç‰¹æ€§
const features = [
  {
    icon: 'ğŸ‘¥',
    title: 'å¤šè´¦å·ç®¡ç†',
    description: 'æ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªé—²é±¼è´¦å·ï¼Œè½»æ¾åˆ‡æ¢',
    color: '#409eff'
  },
  {
    icon: 'ğŸš€',
    title: 'è‡ªåŠ¨å‘è´§',
    description: 'ä¹°å®¶ä»˜æ¬¾åè‡ªåŠ¨å‘é€å‘è´§ä¿¡æ¯ï¼ŒèŠ‚çœæ—¶é—´',
    color: '#67c23a'
  },
  {
    icon: 'ğŸ’¬',
    title: 'è‡ªåŠ¨å›å¤',
    description: 'æ™ºèƒ½åŒ¹é…å…³é”®è¯ï¼Œè‡ªåŠ¨å›å¤ä¹°å®¶æ¶ˆæ¯',
    color: '#e6a23c'
  },
  {
    icon: 'ğŸ“Š',
    title: 'æ•°æ®ç»Ÿè®¡',
    description: 'å®æ—¶æŸ¥çœ‹å•†å“ã€è®¢å•ã€æ¶ˆæ¯ç­‰æ•°æ®ç»Ÿè®¡',
    color: '#f56c6c'
  },
  {
    icon: 'ğŸ”„',
    title: 'Tokenè‡ªåŠ¨åˆ·æ–°',
    description: 'æ™ºèƒ½ç»´æŠ¤ç™»å½•çŠ¶æ€ï¼Œæ— éœ€é¢‘ç¹é‡æ–°ç™»å½•',
    color: '#909399'
  },
  {
    icon: 'ğŸ“œ',
    title: 'æ“ä½œæ—¥å¿—',
    description: 'è¯¦ç»†è®°å½•æ‰€æœ‰æ“ä½œï¼Œæ–¹ä¾¿è¿½è¸ªå’Œæ’æŸ¥',
    color: '#606266'
  }
];

// å¸¸è§é—®é¢˜
const faqs = [
  {
    question: 'å¦‚ä½•è·å–Cookieï¼Ÿ',
    answer: 'åœ¨è¿æ¥ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»Cookieéƒ¨åˆ†çš„"â“"å¸®åŠ©æŒ‰é’®ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„è·å–æ­¥éª¤å’Œç¤ºä¾‹å›¾ç‰‡ã€‚'
  },
  {
    question: 'WebSocketè¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ',
    answer: '1. æ£€æŸ¥Cookieæ˜¯å¦æœ‰æ•ˆï¼›2. å°è¯•åˆ·æ–°Tokenï¼›3. å¦‚æœæç¤ºéœ€è¦æ»‘å—éªŒè¯ï¼Œè®¿é—® https://www.goofish.com/im å®ŒæˆéªŒè¯åæ‰‹åŠ¨æ›´æ–°Cookieå’ŒTokenã€‚'
  },
  {
    question: 'è‡ªåŠ¨å‘è´§ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ',
    answer: 'å½“ä¹°å®¶ä»˜æ¬¾åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹åˆ°"å·²ä»˜æ¬¾å¾…å‘è´§"æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®é…ç½®è‡ªåŠ¨å‘é€å‘è´§ä¿¡æ¯ã€‚'
  },
  {
    question: 'Tokenè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ',
    answer: 'ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ·æ–°Tokenï¼ˆ1.5-2.5å°æ—¶åˆ·æ–°ä¸€æ¬¡ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨è¿æ¥ç®¡ç†é¡µé¢æ‰‹åŠ¨åˆ·æ–°ã€‚'
  }
];

// è·³è½¬åˆ°æŒ‡å®šé¡µé¢
const navigateTo = (route: string) => {
  router.push(route);
};
</script>

<template>
  <div class="dashboard-page">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <el-row :gutter="20" class="stats-row" v-loading="loading">
      <el-col :span="8">
        <el-card shadow="hover" class="stat-card">
          <div class="stat-content">
            <div class="stat-icon account-icon">ğŸ‘¤</div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.accountCount }}</div>
              <div class="stat-label">é—²é±¼è´¦å·</div>
            </div>
          </div>
        </el-card>
      </el-col>
      
      <el-col :span="8">
        <el-card shadow="hover" class="stat-card">
          <div class="stat-content">
            <div class="stat-icon goods-icon">ğŸ“¦</div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.goodsCount }}</div>
              <div class="stat-label">å•†å“æ€»æ•°</div>
            </div>
          </div>
        </el-card>
      </el-col>
      
      <el-col :span="8">
        <el-card shadow="hover" class="stat-card">
          <div class="stat-content">
            <div class="stat-icon online-icon">ğŸ”¥</div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.onlineGoodsCount }}</div>
              <div class="stat-label">åœ¨å”®å•†å“</div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- å¿«é€Ÿå¼€å§‹æŒ‡å— -->
    <el-card class="guide-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span class="card-title">ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—</span>
          <span class="card-subtitle">4æ­¥å®Œæˆç³»ç»Ÿé…ç½®ï¼Œå¼€å¯è‡ªåŠ¨åŒ–ä¹‹æ—…</span>
        </div>
      </template>
      
      <el-steps :active="activeStep" align-center class="steps-container">
        <el-step 
          v-for="(step, index) in quickStartSteps" 
          :key="index"
          :title="step.title"
          :icon="step.icon"
        />
      </el-steps>

      <div class="steps-content">
        <el-row :gutter="20">
          <el-col 
            :span="6" 
            v-for="(step, index) in quickStartSteps" 
            :key="index"
          >
            <el-card 
              shadow="hover" 
              class="step-card"
              :class="{ active: activeStep === index }"
              @click="activeStep = index"
            >
              <div class="step-icon">{{ step.icon }}</div>
              <h3 class="step-title">{{ step.title }}</h3>
              <p class="step-description">{{ step.description }}</p>
              <ul class="step-details">
                <li v-for="(detail, idx) in step.details" :key="idx">
                  {{ detail }}
                </li>
              </ul>
              <el-button 
                type="primary" 
                size="small" 
                @click.stop="navigateTo(step.route)"
                class="step-button"
              >
                å‰å¾€æ“ä½œ â†’
              </el-button>
            </el-card>
          </el-col>
        </el-row>
      </div>
    </el-card>

    <!-- åŠŸèƒ½ç‰¹æ€§ -->
    <el-card class="features-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span class="card-title">âœ¨ åŠŸèƒ½ç‰¹æ€§</span>
          <span class="card-subtitle">å¼ºå¤§çš„è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œæå‡æ‚¨çš„å·¥ä½œæ•ˆç‡</span>
        </div>
      </template>
      
      <el-row :gutter="20">
        <el-col :span="8" v-for="(feature, index) in features" :key="index">
          <el-card shadow="hover" class="feature-card">
            <div class="feature-icon" :style="{ color: feature.color }">
              {{ feature.icon }}
            </div>
            <h3 class="feature-title">{{ feature.title }}</h3>
            <p class="feature-description">{{ feature.description }}</p>
          </el-card>
        </el-col>
      </el-row>
    </el-card>

    <!-- å¸¸è§é—®é¢˜ -->
    <el-card class="faq-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span class="card-title">â“ å¸¸è§é—®é¢˜</span>
          <span class="card-subtitle">å¿«é€Ÿè§£ç­”æ‚¨çš„ç–‘é—®</span>
        </div>
      </template>
      
      <el-collapse accordion>
        <el-collapse-item 
          v-for="(faq, index) in faqs" 
          :key="index"
          :name="index"
        >
          <template #title>
            <span class="faq-question">{{ faq.question }}</span>
          </template>
          <div class="faq-answer">{{ faq.answer }}</div>
        </el-collapse-item>
      </el-collapse>
    </el-card>

    <!-- åº•éƒ¨æç¤º -->
    <el-card class="tips-card" shadow="never">
      <el-alert
        title="ğŸ’¡ æ¸©é¦¨æç¤º"
        type="info"
        :closable="false"
      >
        <ul class="tips-list">
          <li>ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ·æ–°Tokenï¼Œä¿æŒç™»å½•çŠ¶æ€ï¼Œæ— éœ€é¢‘ç¹é‡æ–°ç™»å½•</li>
          <li>å»ºè®®ä¸è¦é¢‘ç¹å¯åŠ¨/æ–­å¼€è¿æ¥ï¼Œé¿å…è§¦å‘äººæœºéªŒè¯</li>
          <li>è‡ªåŠ¨å‘è´§å’Œè‡ªåŠ¨å›å¤éœ€è¦å…ˆå¯åŠ¨WebSocketè¿æ¥æ‰èƒ½ç”Ÿæ•ˆ</li>
          <li>æ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•åœ¨"æ“ä½œæ—¥å¿—"ä¸­ï¼Œæ–¹ä¾¿è¿½è¸ªå’Œæ’æŸ¥é—®é¢˜</li>
        </ul>
      </el-alert>
    </el-card>
  </div>
</template>

<style scoped src="./dashboard.css"></style>
