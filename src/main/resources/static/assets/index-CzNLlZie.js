import{d as U,g as O,u as j,m as z,r as L,a as F}from"./account-CfoO5zdO.js";import{s as N,a as V,g as B,f as E}from"./index-OiMc3YKb.js";import{r as k,a as G,d as h,w as H,b as J,i as D,f as t,e as l,g as r,j as g,t as x,u as i,o as A,k as Q,h as f,c as q,l as K,_ as R}from"./index-DAN5Cn3s.js";function W(){const m=k(!1),v=k([]),p=G({add:!1,manualAdd:!1,qrLogin:!1,deleteConfirm:!1}),a=k(null),d=k(null),s=async()=>{m.value=!0;try{const u=await O();if(u.code===0||u.code===200)v.value=u.data?.accounts||[];else throw new Error(u.msg||"èŽ·å–è´¦å·åˆ—è¡¨å¤±è´¥")}catch(u){V("åŠ è½½è´¦å·åˆ—è¡¨å¤±è´¥: "+u.message),v.value=[]}finally{m.value=!1}};return{loading:m,accounts:v,dialogs:p,currentAccount:a,deleteAccountId:d,loadAccounts:s,showAddDialog:()=>{a.value=null,p.add=!0},showManualAddDialog:()=>{p.manualAdd=!0},showQRLoginDialog:()=>{p.qrLogin=!0},editAccount:u=>{a.value=u,p.add=!0},deleteAccount:u=>{d.value=u,p.deleteConfirm=!0},confirmDelete:async()=>{if(d.value)try{const u=await U({id:d.value});if(u.code===0||u.code===200)N("è´¦å·åˆ é™¤æˆåŠŸ"),p.deleteConfirm=!1,await s();else throw new Error(u.msg||"åˆ é™¤å¤±è´¥")}catch(u){V("åˆ é™¤å¤±è´¥: "+u.message)}}}}const X=h({__name:"AccountTable",props:{accounts:{},loading:{type:Boolean}},emits:["edit","delete"],setup(m,{emit:v}){const p=v;return(a,d)=>{const s=r("el-table-column"),_=r("el-tag"),o=r("el-button"),n=r("el-empty"),w=r("el-table"),y=J("loading");return H((A(),D(w,{data:m.accounts,stripe:""},{empty:t(()=>[l(n,{description:"æš‚æ— è´¦å·æ•°æ®"})]),default:t(()=>[l(s,{prop:"id",label:"ID",width:"80"}),l(s,{prop:"unb",label:"UNB","min-width":"150"}),l(s,{prop:"accountNote",label:"è´¦å·å¤‡æ³¨","min-width":"150"},{default:t(({row:e})=>[g(x(e.accountNote||"æœªå‘½åè´¦å·"),1)]),_:1}),l(s,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:t(({row:e})=>[l(_,{type:i(B)(e.status).type},{default:t(()=>[g(x(i(B)(e.status).text),1)]),_:2},1032,["type"])]),_:1}),l(s,{prop:"createdTime",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:t(({row:e})=>[g(x(i(E)(e.createdTime)),1)]),_:1}),l(s,{prop:"updatedTime",label:"æ›´æ–°æ—¶é—´",width:"180"},{default:t(({row:e})=>[g(x(i(E)(e.updatedTime)),1)]),_:1}),l(s,{label:"æ“ä½œ",width:"180",fixed:"right"},{default:t(({row:e})=>[l(o,{size:"small",onClick:u=>p("edit",e)},{default:t(()=>[...d[0]||(d[0]=[g("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(o,{size:"small",type:"danger",onClick:u=>p("delete",e.id)},{default:t(()=>[...d[1]||(d[1]=[g("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[y,m.loading]])}}}),Y=h({__name:"AddAccountDialog",props:{modelValue:{type:Boolean},account:{}},emits:["update:modelValue","success"],setup(m,{emit:v}){const p=m,a=v,d=k({accountId:0,accountNote:""});Q(()=>p.account,o=>{o?d.value={accountId:o.id,accountNote:o.accountNote||""}:d.value={accountId:0,accountNote:""}},{immediate:!0});const s=()=>{a("update:modelValue",!1)},_=async()=>{if(!d.value.accountNote.trim()){V("è¯·è¾“å…¥è´¦å·å¤‡æ³¨");return}try{const o=await j(d.value);if(o.code===0||o.code===200)N("ä¿å­˜æˆåŠŸ"),s(),a("success");else throw new Error(o.msg||"ä¿å­˜å¤±è´¥")}catch(o){V("ä¿å­˜å¤±è´¥: "+o.message)}};return(o,n)=>{const w=r("el-input"),y=r("el-form-item"),e=r("el-form"),u=r("el-button"),C=r("el-dialog");return A(),D(C,{"model-value":m.modelValue,title:m.account?"ç¼–è¾‘è´¦å·":"æ·»åŠ è´¦å·",width:"500px",onClose:s},{footer:t(()=>[l(u,{onClick:s},{default:t(()=>[...n[1]||(n[1]=[g("å–æ¶ˆ",-1)])]),_:1}),l(u,{type:"primary",onClick:_},{default:t(()=>[...n[2]||(n[2]=[g("ä¿å­˜",-1)])]),_:1})]),default:t(()=>[l(e,{model:d.value,"label-width":"100px"},{default:t(()=>[l(y,{label:"è´¦å·å¤‡æ³¨"},{default:t(()=>[l(w,{modelValue:d.value.accountNote,"onUpdate:modelValue":n[0]||(n[0]=c=>d.value.accountNote=c),placeholder:"è¯·è¾“å…¥è´¦å·å¤‡æ³¨"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}}),Z=h({__name:"ManualAddDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(m,{emit:v}){const p=v,a=k({accountNote:"",unb:"",cookieText:""}),d=()=>{p("update:modelValue",!1),a.value={accountNote:"",unb:"",cookieText:""}},s=async()=>{if(!a.value.accountNote.trim()){V("è¯·è¾“å…¥è´¦å·å¤‡æ³¨");return}if(!a.value.cookieText.trim()){V("è¯·è¾“å…¥ Cookie");return}try{const _=await z(a.value);if(_.code===0||_.code===200)N("è´¦å·æ·»åŠ æˆåŠŸ"),d(),p("success");else throw new Error(_.msg||"æ·»åŠ å¤±è´¥")}catch(_){V("æ·»åŠ å¤±è´¥: "+_.message)}};return(_,o)=>{const n=r("el-input"),w=r("el-form-item"),y=r("el-form"),e=r("el-button"),u=r("el-dialog");return A(),D(u,{"model-value":m.modelValue,title:"æ‰‹åŠ¨æ·»åŠ é—²é±¼è´¦å·",width:"600px",onClose:d},{footer:t(()=>[l(e,{onClick:d},{default:t(()=>[...o[2]||(o[2]=[g("å–æ¶ˆ",-1)])]),_:1}),l(e,{type:"primary",onClick:s},{default:t(()=>[...o[3]||(o[3]=[g("æ·»åŠ è´¦å·",-1)])]),_:1})]),default:t(()=>[l(y,{model:a.value,"label-width":"100px"},{default:t(()=>[l(w,{label:"è´¦å·å¤‡æ³¨"},{default:t(()=>[l(n,{modelValue:a.value.accountNote,"onUpdate:modelValue":o[0]||(o[0]=C=>a.value.accountNote=C),placeholder:"è¯·è¾“å…¥è´¦å·å¤‡æ³¨"},null,8,["modelValue"])]),_:1}),l(w,{label:"Cookie"},{default:t(()=>[l(n,{modelValue:a.value.cookieText,"onUpdate:modelValue":o[1]||(o[1]=C=>a.value.cookieText=C),type:"textarea",rows:6,placeholder:"è¯·è¾“å…¥å®Œæ•´çš„ Cookie å­—ç¬¦ä¸²"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}});function ee(){return L({url:"/qrlogin/generate",method:"POST"})}function oe(m){return L({url:`/qrlogin/status/${m}`,method:"POST"})}function te(m){return L({url:`/qrlogin/cookies/${m}`,method:"POST"})}const le={class:"qr-login-content"},ne={class:"qr-code-container"},ae=["src"],se={class:"qr-status"},ce={key:0,class:"session-id"},de=h({__name:"QRLoginDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(m,{emit:v}){const p=m,a=v,d=k(""),s=k(""),_=k("pending"),o=k("æ­£åœ¨ç”ŸæˆäºŒç»´ç ...");let n=null;Q(()=>p.modelValue,c=>{c?w():e()});const w=async()=>{try{const c=await ee();if(c.code===0||c.code===200)d.value=c.data?.qrCodeUrl||"",s.value=c.data?.sessionId||"",y();else throw new Error(c.msg||"ç”ŸæˆäºŒç»´ç å¤±è´¥")}catch(c){V("ç”ŸæˆäºŒç»´ç å¤±è´¥: "+c.message)}},y=()=>{n=window.setInterval(async()=>{try{const c=await oe(s.value);if(c.code===0||c.code===200){const b=c.data;switch(_.value=b?.status||"pending",b?.status){case"pending":o.value="ç­‰å¾…æ‰«ç ...";break;case"scanned":o.value="å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤...";break;case"confirmed":o.value="ç™»å½•æˆåŠŸï¼æ­£åœ¨èŽ·å–ä¿¡æ¯...",await u();break;case"expired":o.value="äºŒç»´ç å·²è¿‡æœŸ",e();break}}}catch(c){console.error("æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:",c)}},2e3)},e=()=>{n&&(clearInterval(n),n=null)},u=async()=>{try{const c=await te(s.value);if(c.code===0||c.code===200){const b=c.data?.cookies||{},T=b.unb||"",I=Object.entries(b).map(([P,M])=>`${P}=${M}`).join("; "),S=`è´¦å·_${T||Date.now()}`,$=await F({accountNote:S,unb:T,cookieText:I});($.code===0||$.code===200)&&(N("è´¦å·æ·»åŠ æˆåŠŸ"),C(),a("success"))}}catch(c){V("å¤„ç†ç™»å½•å¤±è´¥: "+c.message)}finally{e()}},C=()=>{e(),a("update:modelValue",!1)};return(c,b)=>{const T=r("el-skeleton"),I=r("el-tag"),S=r("el-button"),$=r("el-dialog");return A(),D($,{"model-value":m.modelValue,title:"æ‰«ç æ·»åŠ é—²é±¼è´¦å·",width:"400px",onClose:C},{footer:t(()=>[l(S,{onClick:C},{default:t(()=>[...b[1]||(b[1]=[g("å–æ¶ˆ",-1)])]),_:1})]),default:t(()=>[f("div",le,[f("div",ne,[d.value?(A(),q("img",{key:0,src:d.value,alt:"äºŒç»´ç ",class:"qr-code"},null,8,ae)):(A(),D(T,{key:1,animated:""}))]),b[0]||(b[0]=f("p",{class:"qr-tip"},"è¯·ä½¿ç”¨é—²é±¼APPæ‰«æäºŒç»´ç ç™»å½•",-1)),f("div",se,[l(I,{type:_.value==="confirmed"?"success":"info"},{default:t(()=>[g(x(o.value),1)]),_:1},8,["type"])]),s.value?(A(),q("p",ce,"ä¼šè¯ID: "+x(s.value),1)):K("",!0)])]),_:1},8,["model-value"])}}}),ue=R(de,[["__scopeId","data-v-5d8e8c5f"]]),ie={class:"delete-confirm-content"},re=h({__name:"DeleteConfirmDialog",props:{modelValue:{type:Boolean},accountId:{}},emits:["update:modelValue","success"],setup(m,{emit:v}){const p=m,a=v,d=k(!1),s=()=>{a("update:modelValue",!1)},_=async()=>{if(p.accountId){d.value=!0;try{const o=await U({id:p.accountId});if(o.code===0||o.code===200)N("è´¦å·åˆ é™¤æˆåŠŸ"),s(),a("success");else throw new Error(o.msg||"åˆ é™¤å¤±è´¥")}catch(o){V("åˆ é™¤å¤±è´¥: "+o.message)}finally{d.value=!1}}};return(o,n)=>{const w=r("el-alert"),y=r("el-button"),e=r("el-dialog");return A(),D(e,{"model-value":m.modelValue,title:"åˆ é™¤è´¦å·ç¡®è®¤",width:"500px",onClose:s},{footer:t(()=>[l(y,{onClick:s},{default:t(()=>[...n[5]||(n[5]=[g("å–æ¶ˆ",-1)])]),_:1}),l(y,{type:"danger",loading:d.value,onClick:_},{default:t(()=>[...n[6]||(n[6]=[g(" ç¡®å®šåˆ é™¤ ",-1)])]),_:1},8,["loading"])]),default:t(()=>[f("div",ie,[n[4]||(n[4]=f("p",{class:"confirm-text"},"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿ",-1)),l(w,{type:"error",closable:!1,"show-icon":""},{title:t(()=>[...n[0]||(n[0]=[f("strong",null,"é‡è¦æé†’",-1)])]),default:t(()=>[n[1]||(n[1]=f("p",null,"åˆ é™¤è´¦å·å°†ä¼šåŒæ—¶åˆ é™¤è¯¥è´¦å·ä¸‹çš„æ‰€æœ‰ç›¸å…³æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š",-1)),n[2]||(n[2]=f("ul",null,[f("li",null,"èŠå¤©æ¶ˆæ¯è®°å½•"),f("li",null,"å•†å“ä¿¡æ¯"),f("li",null,"è‡ªåŠ¨å‘è´§é…ç½®å’Œè®°å½•"),f("li",null,"è‡ªåŠ¨å›žå¤é…ç½®å’Œè®°å½•"),f("li",null,"Cookieä¿¡æ¯")],-1)),n[3]||(n[3]=f("p",null,[f("strong",null,"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œï¼")],-1))]),_:1})])]),_:1},8,["model-value"])}}}),me=R(re,[["__scopeId","data-v-f5452635"]]),pe={class:"accounts-page"},fe={class:"page-header"},_e={class:"header-actions"},ge={class:"card-header"},ve=h({__name:"index",setup(m){const{loading:v,accounts:p,dialogs:a,deleteAccountId:d,loadAccounts:s,showManualAddDialog:_,showQRLoginDialog:o,editAccount:n,deleteAccount:w}=W();return s(),(y,e)=>{const u=r("el-button"),C=r("el-card");return A(),q("div",pe,[f("div",fe,[e[6]||(e[6]=f("h1",{class:"page-title"},"é—²é±¼è´¦å·",-1)),f("div",_e,[l(u,{type:"primary",onClick:i(o)},{default:t(()=>[...e[4]||(e[4]=[g(" ðŸ“± æ‰«ç æ·»åŠ é—²é±¼è´¦å· ",-1)])]),_:1},8,["onClick"]),l(u,{onClick:i(_)},{default:t(()=>[...e[5]||(e[5]=[g(" + æ‰‹åŠ¨æ·»åŠ  ",-1)])]),_:1},8,["onClick"])])]),l(C,{class:"account-card"},{header:t(()=>[f("div",ge,[e[8]||(e[8]=f("span",{class:"card-title"},"é—²é±¼è´¦å·åˆ—è¡¨",-1)),l(u,{type:"primary",link:"",onClick:i(s),loading:i(v)},{default:t(()=>[...e[7]||(e[7]=[g(" åˆ·æ–° ",-1)])]),_:1},8,["onClick","loading"])])]),default:t(()=>[l(X,{accounts:i(p),loading:i(v),onEdit:i(n),onDelete:i(w)},null,8,["accounts","loading","onEdit","onDelete"])]),_:1}),l(Y,{modelValue:i(a).add,"onUpdate:modelValue":e[0]||(e[0]=c=>i(a).add=c)},null,8,["modelValue"]),l(Z,{modelValue:i(a).manualAdd,"onUpdate:modelValue":e[1]||(e[1]=c=>i(a).manualAdd=c),onSuccess:i(s)},null,8,["modelValue","onSuccess"]),l(ue,{modelValue:i(a).qrLogin,"onUpdate:modelValue":e[2]||(e[2]=c=>i(a).qrLogin=c),onSuccess:i(s)},null,8,["modelValue","onSuccess"]),l(me,{modelValue:i(a).deleteConfirm,"onUpdate:modelValue":e[3]||(e[3]=c=>i(a).deleteConfirm=c),"account-id":i(d),onSuccess:i(s)},null,8,["modelValue","account-id","onSuccess"])])}}}),ke=R(ve,[["__scopeId","data-v-63382e3c"]]);export{ke as default};
