import{d as U,s as N,a as h,g as O,b as B,f as E,u as j,m as z,c as F}from"./index-BTFSt2fU.js";import{r as k,a as G,d as D,w as H,e as J,f as x,g as t,b as l,h as r,m as v,t as A,u as d,o as V,q as Q,i as _,c as q,s as K,_ as L}from"./index-7CieyMQU.js";import{r as R}from"./request-DTdiWb_T.js";function W(){const m=k(!1),w=k([]),f=G({add:!1,manualAdd:!1,qrLogin:!1,deleteConfirm:!1}),a=k(null),s=k(null),c=async()=>{m.value=!0;try{const e=await O();if(e.code===0||e.code===200)w.value=e.data?.accounts||[];else throw new Error(e.msg||"èŽ·å–è´¦å·åˆ—è¡¨å¤±è´¥")}catch(e){h("åŠ è½½è´¦å·åˆ—è¡¨å¤±è´¥: "+e.message),w.value=[]}finally{m.value=!1}};return{loading:m,accounts:w,dialogs:f,currentAccount:a,deleteAccountId:s,loadAccounts:c,showAddDialog:()=>{a.value=null,f.add=!0},showManualAddDialog:()=>{f.manualAdd=!0},showQRLoginDialog:()=>{f.qrLogin=!0},editAccount:e=>{a.value=e,f.add=!0},deleteAccount:e=>{s.value=e,f.deleteConfirm=!0},confirmDelete:async()=>{if(s.value)try{const e=await U({id:s.value});if(e.code===0||e.code===200)N("è´¦å·åˆ é™¤æˆåŠŸ"),f.deleteConfirm=!1,await c();else throw new Error(e.msg||"åˆ é™¤å¤±è´¥")}catch(e){h("åˆ é™¤å¤±è´¥: "+e.message)}}}}const X=D({__name:"AccountTable",props:{accounts:{},loading:{type:Boolean}},emits:["edit","delete"],setup(m,{emit:w}){const f=w;return(a,s)=>{const c=r("el-table-column"),p=r("el-tag"),o=r("el-button"),n=r("el-empty"),y=r("el-table"),C=J("loading");return H((V(),x(y,{data:m.accounts,stripe:""},{empty:t(()=>[l(n,{description:"æš‚æ— è´¦å·æ•°æ®"})]),default:t(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"unb",label:"UNB","min-width":"150"}),l(c,{prop:"accountNote",label:"è´¦å·å¤‡æ³¨","min-width":"150"},{default:t(({row:i})=>[v(A(i.accountNote||"æœªå‘½åè´¦å·"),1)]),_:1}),l(c,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:t(({row:i})=>[l(p,{type:d(B)(i.status).type},{default:t(()=>[v(A(d(B)(i.status).text),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"createdTime",label:"åˆ›å»ºæ—¶é—´",width:"180"},{default:t(({row:i})=>[v(A(d(E)(i.createdTime)),1)]),_:1}),l(c,{prop:"updatedTime",label:"æ›´æ–°æ—¶é—´",width:"180"},{default:t(({row:i})=>[v(A(d(E)(i.updatedTime)),1)]),_:1}),l(c,{label:"æ“ä½œ",width:"180",fixed:"right"},{default:t(({row:i})=>[l(o,{size:"small",onClick:e=>f("edit",i)},{default:t(()=>[...s[0]||(s[0]=[v("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),l(o,{size:"small",type:"danger",onClick:e=>f("delete",i.id)},{default:t(()=>[...s[1]||(s[1]=[v("åˆ é™¤",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[C,m.loading]])}}}),Y=D({__name:"AddAccountDialog",props:{modelValue:{type:Boolean},account:{}},emits:["update:modelValue","success"],setup(m,{emit:w}){const f=m,a=w,s=k({accountId:0,accountNote:""});Q(()=>f.account,o=>{o?s.value={accountId:o.id,accountNote:o.accountNote||""}:s.value={accountId:0,accountNote:""}},{immediate:!0});const c=()=>{a("update:modelValue",!1)},p=async()=>{if(!s.value.accountNote.trim()){h("è¯·è¾“å…¥è´¦å·å¤‡æ³¨");return}try{const o=await j(s.value);if(o.code===0||o.code===200)N("ä¿å­˜æˆåŠŸ"),c(),a("success");else throw new Error(o.msg||"ä¿å­˜å¤±è´¥")}catch(o){console.error("ä¿å­˜å¤±è´¥:",o)}};return(o,n)=>{const y=r("el-input"),C=r("el-form-item"),i=r("el-form"),e=r("el-button"),b=r("el-dialog");return V(),x(b,{"model-value":m.modelValue,title:m.account?"ç¼–è¾‘è´¦å·":"æ·»åŠ è´¦å·",width:"500px",onClose:c},{footer:t(()=>[l(e,{onClick:c},{default:t(()=>[...n[1]||(n[1]=[v("å–æ¶ˆ",-1)])]),_:1}),l(e,{type:"primary",onClick:p},{default:t(()=>[...n[2]||(n[2]=[v("ä¿å­˜",-1)])]),_:1})]),default:t(()=>[l(i,{model:s.value,"label-width":"100px"},{default:t(()=>[l(C,{label:"è´¦å·å¤‡æ³¨"},{default:t(()=>[l(y,{modelValue:s.value.accountNote,"onUpdate:modelValue":n[0]||(n[0]=u=>s.value.accountNote=u),placeholder:"è¯·è¾“å…¥è´¦å·å¤‡æ³¨"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}}),Z=D({__name:"ManualAddDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(m,{emit:w}){const f=w,a=k({accountNote:"",unb:"",cookieText:""}),s=()=>{f("update:modelValue",!1),a.value={accountNote:"",unb:"",cookieText:""}},c=async()=>{if(!a.value.accountNote.trim()){h("è¯·è¾“å…¥è´¦å·å¤‡æ³¨");return}if(!a.value.cookieText.trim()){h("è¯·è¾“å…¥ Cookie");return}try{const p=await z(a.value);if(p.code===0||p.code===200)N("è´¦å·æ·»åŠ æˆåŠŸ"),s(),f("success");else throw new Error(p.msg||"æ·»åŠ å¤±è´¥")}catch(p){console.error("æ·»åŠ å¤±è´¥:",p)}};return(p,o)=>{const n=r("el-input"),y=r("el-form-item"),C=r("el-form"),i=r("el-button"),e=r("el-dialog");return V(),x(e,{"model-value":m.modelValue,title:"æ‰‹åŠ¨æ·»åŠ é—²é±¼è´¦å·",width:"600px",onClose:s},{footer:t(()=>[l(i,{onClick:s},{default:t(()=>[...o[2]||(o[2]=[v("å–æ¶ˆ",-1)])]),_:1}),l(i,{type:"primary",onClick:c},{default:t(()=>[...o[3]||(o[3]=[v("æ·»åŠ è´¦å·",-1)])]),_:1})]),default:t(()=>[l(C,{model:a.value,"label-width":"100px"},{default:t(()=>[l(y,{label:"è´¦å·å¤‡æ³¨"},{default:t(()=>[l(n,{modelValue:a.value.accountNote,"onUpdate:modelValue":o[0]||(o[0]=b=>a.value.accountNote=b),placeholder:"è¯·è¾“å…¥è´¦å·å¤‡æ³¨"},null,8,["modelValue"])]),_:1}),l(y,{label:"Cookie"},{default:t(()=>[l(n,{modelValue:a.value.cookieText,"onUpdate:modelValue":o[1]||(o[1]=b=>a.value.cookieText=b),type:"textarea",rows:6,placeholder:"è¯·è¾“å…¥å®Œæ•´çš„ Cookie å­—ç¬¦ä¸²"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}});function ee(){return R({url:"/qrlogin/generate",method:"POST"})}function oe(m){return R({url:`/qrlogin/status/${m}`,method:"POST"})}function te(m){return R({url:`/qrlogin/cookies/${m}`,method:"POST"})}const le={class:"qr-login-content"},ne={class:"qr-code-container"},ae=["src"],se={class:"qr-status"},ce={key:0,class:"session-id"},ue=D({__name:"QRLoginDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(m,{emit:w}){const f=m,a=w,s=k(""),c=k(""),p=k("pending"),o=k("æ­£åœ¨ç”ŸæˆäºŒç»´ç ...");let n=null;Q(()=>f.modelValue,u=>{u?y():i()});const y=async()=>{try{const u=await ee();if(u.code===0||u.code===200)s.value=u.data?.qrCodeUrl||"",c.value=u.data?.sessionId||"",C();else throw new Error(u.msg||"ç”ŸæˆäºŒç»´ç å¤±è´¥")}catch(u){console.error("ç”ŸæˆäºŒç»´ç å¤±è´¥:",u)}},C=()=>{n=window.setInterval(async()=>{try{const u=await oe(c.value);if(u.code===0||u.code===200){const g=u.data;switch(p.value=g?.status||"pending",g?.status){case"pending":o.value="ç­‰å¾…æ‰«ç ...";break;case"scanned":o.value="å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤...";break;case"confirmed":o.value="ç™»å½•æˆåŠŸï¼æ­£åœ¨èŽ·å–ä¿¡æ¯...",await e();break;case"expired":o.value="äºŒç»´ç å·²è¿‡æœŸ",i();break}}}catch(u){console.error("æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:",u)}},2e3)},i=()=>{n&&(clearInterval(n),n=null)},e=async()=>{try{const u=await te(c.value);if(u.code===0||u.code===200){const g=u.data?.cookies||{},T=g.unb||"",S=Object.entries(g).map(([P,M])=>`${P}=${M}`).join("; "),I=`è´¦å·_${T||Date.now()}`,$=await F({accountNote:I,unb:T,cookieText:S});($.code===0||$.code===200)&&(N("è´¦å·æ·»åŠ æˆåŠŸ"),b(),a("success"))}}catch(u){console.error("å¤„ç†ç™»å½•å¤±è´¥:",u)}finally{i()}},b=()=>{i(),a("update:modelValue",!1)};return(u,g)=>{const T=r("el-skeleton"),S=r("el-tag"),I=r("el-button"),$=r("el-dialog");return V(),x($,{"model-value":m.modelValue,title:"æ‰«ç æ·»åŠ é—²é±¼è´¦å·",width:"400px",onClose:b},{footer:t(()=>[l(I,{onClick:b},{default:t(()=>[...g[1]||(g[1]=[v("å–æ¶ˆ",-1)])]),_:1})]),default:t(()=>[_("div",le,[_("div",ne,[s.value?(V(),q("img",{key:0,src:s.value,alt:"äºŒç»´ç ",class:"qr-code"},null,8,ae)):(V(),x(T,{key:1,animated:""}))]),g[0]||(g[0]=_("p",{class:"qr-tip"},"è¯·ä½¿ç”¨é—²é±¼APPæ‰«æäºŒç»´ç ç™»å½•",-1)),_("div",se,[l(S,{type:p.value==="confirmed"?"success":"info"},{default:t(()=>[v(A(o.value),1)]),_:1},8,["type"])]),c.value?(V(),q("p",ce,"ä¼šè¯ID: "+A(c.value),1)):K("",!0)])]),_:1},8,["model-value"])}}}),de=L(ue,[["__scopeId","data-v-d4422f72"]]),ie={class:"delete-confirm-content"},re=D({__name:"DeleteConfirmDialog",props:{modelValue:{type:Boolean},accountId:{}},emits:["update:modelValue","success"],setup(m,{emit:w}){const f=m,a=w,s=k(!1),c=()=>{a("update:modelValue",!1)},p=async()=>{if(f.accountId){s.value=!0;try{const o=await U({id:f.accountId});if(o.code===0||o.code===200)N("è´¦å·åˆ é™¤æˆåŠŸ"),c(),a("success");else throw new Error(o.msg||"åˆ é™¤å¤±è´¥")}catch(o){console.error("åˆ é™¤å¤±è´¥:",o)}finally{s.value=!1}}};return(o,n)=>{const y=r("el-alert"),C=r("el-button"),i=r("el-dialog");return V(),x(i,{"model-value":m.modelValue,title:"åˆ é™¤è´¦å·ç¡®è®¤",width:"500px",onClose:c},{footer:t(()=>[l(C,{onClick:c},{default:t(()=>[...n[5]||(n[5]=[v("å–æ¶ˆ",-1)])]),_:1}),l(C,{type:"danger",loading:s.value,onClick:p},{default:t(()=>[...n[6]||(n[6]=[v(" ç¡®å®šåˆ é™¤ ",-1)])]),_:1},8,["loading"])]),default:t(()=>[_("div",ie,[n[4]||(n[4]=_("p",{class:"confirm-text"},"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿ",-1)),l(y,{type:"error",closable:!1,"show-icon":""},{title:t(()=>[...n[0]||(n[0]=[_("strong",null,"é‡è¦æé†’",-1)])]),default:t(()=>[n[1]||(n[1]=_("p",null,"åˆ é™¤è´¦å·å°†ä¼šåŒæ—¶åˆ é™¤è¯¥è´¦å·ä¸‹çš„æ‰€æœ‰ç›¸å…³æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š",-1)),n[2]||(n[2]=_("ul",null,[_("li",null,"èŠå¤©æ¶ˆæ¯è®°å½•"),_("li",null,"å•†å“ä¿¡æ¯"),_("li",null,"è‡ªåŠ¨å‘è´§é…ç½®å’Œè®°å½•"),_("li",null,"è‡ªåŠ¨å›žå¤é…ç½®å’Œè®°å½•"),_("li",null,"Cookieä¿¡æ¯")],-1)),n[3]||(n[3]=_("p",null,[_("strong",null,"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œï¼")],-1))]),_:1})])]),_:1},8,["model-value"])}}}),me=L(re,[["__scopeId","data-v-060f2afb"]]),pe={class:"accounts-page"},fe={class:"page-header"},_e={class:"header-actions"},ge={class:"card-header"},ve=D({__name:"index",setup(m){const{loading:w,accounts:f,dialogs:a,currentAccount:s,deleteAccountId:c,loadAccounts:p,showManualAddDialog:o,showQRLoginDialog:n,editAccount:y,deleteAccount:C}=W();return p(),(i,e)=>{const b=r("el-button"),u=r("el-card");return V(),q("div",pe,[_("div",fe,[e[6]||(e[6]=_("h1",{class:"page-title"},"é—²é±¼è´¦å·",-1)),_("div",_e,[l(b,{type:"primary",onClick:d(n)},{default:t(()=>[...e[4]||(e[4]=[v(" ðŸ“± æ‰«ç æ·»åŠ é—²é±¼è´¦å· ",-1)])]),_:1},8,["onClick"]),l(b,{onClick:d(o)},{default:t(()=>[...e[5]||(e[5]=[v(" + æ‰‹åŠ¨æ·»åŠ  ",-1)])]),_:1},8,["onClick"])])]),l(u,{class:"account-card"},{header:t(()=>[_("div",ge,[e[8]||(e[8]=_("span",{class:"card-title"},"é—²é±¼è´¦å·åˆ—è¡¨",-1)),l(b,{type:"primary",link:"",onClick:d(p),loading:d(w)},{default:t(()=>[...e[7]||(e[7]=[v(" åˆ·æ–° ",-1)])]),_:1},8,["onClick","loading"])])]),default:t(()=>[l(X,{accounts:d(f),loading:d(w),onEdit:d(y),onDelete:d(C)},null,8,["accounts","loading","onEdit","onDelete"])]),_:1}),l(Y,{modelValue:d(a).add,"onUpdate:modelValue":e[0]||(e[0]=g=>d(a).add=g),account:d(s),onSuccess:d(p)},null,8,["modelValue","account","onSuccess"]),l(Z,{modelValue:d(a).manualAdd,"onUpdate:modelValue":e[1]||(e[1]=g=>d(a).manualAdd=g),onSuccess:d(p)},null,8,["modelValue","onSuccess"]),l(de,{modelValue:d(a).qrLogin,"onUpdate:modelValue":e[2]||(e[2]=g=>d(a).qrLogin=g),onSuccess:d(p)},null,8,["modelValue","onSuccess"]),l(me,{modelValue:d(a).deleteConfirm,"onUpdate:modelValue":e[3]||(e[3]=g=>d(a).deleteConfirm=g),"account-id":d(c),onSuccess:d(p)},null,8,["modelValue","account-id","onSuccess"])])}}}),be=L(ve,[["__scopeId","data-v-16c62885"]]);export{be as default};
