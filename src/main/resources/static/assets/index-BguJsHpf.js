import{g as X}from"./account-BM0RHrlO.js";import{g as Y,u as Z,a as ee,r as te}from"./goods-DUkgtAex.js";import{a as g,b as S,s as D}from"./index-B9A6kdhu.js";import{G as ae}from"./GoodsDetailDialog-CnLvQ_-U.js";import{d as oe,r as i,m as le,c as O,h as d,e as o,f as s,g as r,F as se,p as ne,j as f,w as ie,b as re,i as R,t as y,o as h,_ as ue}from"./index-udmZ-1w9.js";const de={class:"goods-page"},ce={class:"page-header"},pe={class:"header-actions"},ge={class:"card-header"},ve={class:"card-subtitle"},me={class:"goods-id"},_e={class:"goods-price"},fe={class:"pagination-container"},ye=oe({__name:"index",setup(he){const w=i(!1),x=i(!1),v=i([]),n=i(null),m=i(""),b=i([]),p=i(1),V=i(20),A=i(0),C=i(!1),G=i(""),P=async()=>{try{const e=await X();(e.code===0||e.code===200)&&(v.value=e.data?.accounts||[],v.value.length>0&&!n.value&&(n.value=v.value[0]?.id||null,c()))}catch(e){g("加载账号列表失败: "+e.message)}},c=async()=>{if(!n.value){S("请先选择账号");return}w.value=!0;try{const e={xianyuAccountId:n.value,pageNum:p.value,pageSize:V.value};m.value!==""&&(e.status=parseInt(m.value));const t=await Y(e);if(t.code===0||t.code===200)b.value=t.data?.itemsWithConfig||[],A.value=t.data?.totalCount||0;else throw new Error(t.msg||"获取商品列表失败")}catch(e){g("加载商品列表失败: "+e.message),b.value=[]}finally{w.value=!1}},E=async()=>{if(!n.value){S("请先选择账号");return}x.value=!0;try{const e=await te(n.value);if(e.code===0||e.code===200)D("商品数据刷新成功"),await c();else throw new Error(e.msg||"刷新商品数据失败")}catch(e){g("刷新商品数据失败: "+e.message)}finally{x.value=!1}},M=()=>{p.value=1,c()},N=()=>{p.value=1,c()},T=e=>{p.value=e,c()},B=e=>{G.value=e,C.value=!0},F=async(e,t)=>{if(n.value)try{const l=await Z({xianyuAccountId:n.value,xyGoodsId:e.item.xyGoodId,xianyuAutoDeliveryOn:t?1:0});if(l.code===0||l.code===200)D(`自动发货${t?"开启":"关闭"}成功`),e.xianyuAutoDeliveryOn=t?1:0;else throw new Error(l.msg||"操作失败")}catch(l){g("操作失败: "+l.message),e.xianyuAutoDeliveryOn=t?0:1}},L=async(e,t)=>{if(n.value)try{const l=await ee({xianyuAccountId:n.value,xyGoodsId:e.item.xyGoodId,xianyuAutoReplyOn:t?1:0});if(l.code===0||l.code===200)D(`自动回复${t?"开启":"关闭"}成功`),e.xianyuAutoReplyOn=t?1:0;else throw new Error(l.msg||"操作失败")}catch(l){g("操作失败: "+l.message),e.xianyuAutoReplyOn=t?0:1}},U=e=>({0:"success",1:"info",2:"warning"})[e]||"info",$=e=>({0:"在售",1:"已下架",2:"已售出"})[e]||"未知",j=e=>e?`¥${e}`:"-";return le(()=>{P()}),(e,t)=>{const l=r("el-option"),k=r("el-select"),I=r("el-button"),u=r("el-table-column"),W=r("el-image"),q=r("el-tag"),z=r("el-switch"),H=r("el-table"),J=r("el-pagination"),K=r("el-card"),Q=re("loading");return h(),O("div",de,[d("div",ce,[t[6]||(t[6]=d("h1",{class:"page-title"},"商品管理",-1)),d("div",pe,[o(k,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),placeholder:"选择账号",style:{width:"200px"},onChange:M},{default:s(()=>[(h(!0),O(se,null,ne(v.value,a=>(h(),R(l,{key:a.id,label:a.accountNote||a.unb,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(k,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),placeholder:"全部状态",style:{width:"150px"},clearable:"",onChange:N},{default:s(()=>[o(l,{label:"在售商品",value:"0"}),o(l,{label:"已下架",value:"1"}),o(l,{label:"已售出",value:"2"})]),_:1},8,["modelValue"]),o(I,{onClick:c},{default:s(()=>[...t[4]||(t[4]=[f("刷新列表",-1)])]),_:1}),o(I,{type:"primary",loading:x.value,onClick:E},{default:s(()=>[...t[5]||(t[5]=[f(" 同步闲鱼商品 ",-1)])]),_:1},8,["loading"])])]),o(K,{class:"goods-card"},{header:s(()=>[d("div",ge,[t[7]||(t[7]=d("span",{class:"card-title"},"商品列表",-1)),d("span",ve,"共 "+y(A.value)+" 件商品",1)])]),default:s(()=>[ie((h(),R(H,{data:b.value,stripe:"",style:{width:"100%"},size:"small"},{default:s(()=>[o(u,{type:"index",label:"序号",width:"50",align:"center"}),o(u,{prop:"item.xyGoodId",label:"商品ID",width:"120"},{default:s(({row:a})=>[d("div",me,y(a.item.xyGoodId),1)]),_:1}),o(u,{label:"商品图片",width:"60"},{default:s(({row:a})=>[o(W,{src:a.item.coverPic,fit:"cover",class:"goods-image","preview-src-list":[a.item.coverPic]},null,8,["src","preview-src-list"])]),_:1}),o(u,{prop:"item.title",label:"商品标题","min-width":"150","show-overflow-tooltip":""}),o(u,{label:"价格",width:"100",align:"right"},{default:s(({row:a})=>[d("span",_e,y(j(a.item.soldPrice)),1)]),_:1}),o(u,{label:"状态",width:"80"},{default:s(({row:a})=>[o(q,{type:U(a.item.status),size:"small"},{default:s(()=>[f(y($(a.item.status)),1)]),_:2},1032,["type"])]),_:1}),o(u,{label:"自动发货",width:"80",align:"center"},{default:s(({row:a})=>[o(z,{"model-value":a.xianyuAutoDeliveryOn===1,onChange:_=>F(a,_),size:"small"},null,8,["model-value","onChange"])]),_:1}),o(u,{label:"自动回复",width:"80",align:"center"},{default:s(({row:a})=>[o(z,{"model-value":a.xianyuAutoReplyOn===1,onChange:_=>L(a,_),size:"small"},null,8,["model-value","onChange"])]),_:1}),o(u,{label:"操作",width:"100",align:"center",fixed:"right"},{default:s(({row:a})=>[o(I,{type:"primary",link:"",size:"small",onClick:_=>B(a.item.xyGoodId)},{default:s(()=>[...t[8]||(t[8]=[f(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,w.value]]),d("div",fe,[o(J,{"current-page":p.value,"onUpdate:currentPage":t[2]||(t[2]=a=>p.value=a),"page-size":V.value,total:A.value,layout:"total, prev, pager, next, jumper",onCurrentChange:T},null,8,["current-page","page-size","total"])])]),_:1}),o(ae,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=a=>C.value=a),"goods-id":G.value,"account-id":n.value,onRefresh:c},null,8,["modelValue","goods-id","account-id"])])}}}),Ie=ue(ye,[["__scopeId","data-v-572d1faf"]]);export{Ie as default};
