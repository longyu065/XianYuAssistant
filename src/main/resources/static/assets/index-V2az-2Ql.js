import{g as q,e as F,a as I,s as L}from"./index-BTFSt2fU.js";import{g as M,c as $}from"./auto-delivery-record-lhsB70g4.js";import{d as G,r as u,x as H,c as b,i as r,b as o,g as s,h as d,F as J,j as K,w as O,e as Q,s as W,m as p,t as c,E as X,o as v,f as Y,_ as Z}from"./index-7CieyMQU.js";import"./request-DTdiWb_T.js";const ee={class:"orders-page"},te={class:"page-header"},ae={class:"header-actions"},oe={class:"card-header"},se={class:"card-subtitle"},le={class:"table-wrapper"},ne={class:"order-id"},re={class:"content-text"},de={key:0,class:"pagination-container"},ce=G({__name:"index",setup(ie){const w=u(!1),f=u([]),i=u(null),h=u([]),_=u(0),m=u(1),y=u(20),C=a=>a?a.replace("T"," ").substring(0,19):"-",S=async()=>{try{const a=await q();(a.code===0||a.code===200)&&(f.value=a.data?.accounts||[],f.value.length>0&&!i.value&&(i.value=f.value[0]?.id||null,g()))}catch(a){console.error("加载账号列表失败:",a)}},z=()=>{m.value=1,g()},g=async()=>{if(!i.value){h.value=[],_.value=0;return}w.value=!0;try{const a={xianyuAccountId:i.value,pageNum:m.value,pageSize:y.value},t=await M(a);if(t.code===0||t.code===200)h.value=t.data?.records||[],_.value=t.data?.total||0;else throw new Error(t.msg||"获取记录失败")}catch(a){console.error("加载自动发货记录失败:",a),h.value=[],_.value=0}finally{w.value=!1}},T=a=>{m.value=a,g()},k=a=>{y.value=a,m.value=1,g()},D=a=>a===1?"success":"danger",N=a=>a===1?"成功":"失败",A=async a=>{if(!i.value){F("请先选择账号");return}if(!a.orderId){I("该记录没有订单ID，无法确认收货");return}try{await X.confirm(`确定要确认收货吗？订单ID: ${a.orderId}`,"确认收货",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={xianyuAccountId:i.value,orderId:a.orderId},l=await $(t);if(l.code===0||l.code===200)L(l.data||"确认收货成功"),await g();else throw l.msg&&l.msg.includes("Token")||l.msg&&l.msg.includes("令牌")?new Error("Cookie已过期，请重新扫码登录获取新的Cookie"):new Error(l.msg||"确认收货失败")}catch(t){if(t==="cancel")return;console.error("确认收货失败:",t),I(t.message||"确认收货失败")}};return H(()=>{S()}),(a,t)=>{const l=d("el-option"),B=d("el-select"),n=d("el-table-column"),x=d("el-tag"),E=d("el-button"),U=d("el-empty"),V=d("el-table"),R=d("el-pagination"),P=d("el-card"),j=Q("loading");return v(),b("div",ee,[r("div",te,[t[4]||(t[4]=r("h1",{class:"page-title"},"订单管理",-1)),r("div",ae,[t[3]||(t[3]=r("span",{class:"account-label"},"选择闲鱼账号",-1)),o(B,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),placeholder:"选择账号",style:{width:"200px"},onChange:z},{default:s(()=>[(v(!0),b(J,null,K(f.value,e=>(v(),Y(l,{key:e.id,label:e.accountNote||e.unb,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),o(P,{class:"orders-card"},{header:s(()=>[r("div",oe,[t[5]||(t[5]=r("span",{class:"card-title"},"自动发货订单记录",-1)),r("span",se,"共 "+c(_.value)+" 条记录",1)])]),default:s(()=>[O((v(),b("div",le,[o(V,{data:h.value,stripe:"",style:{width:"100%"}},{empty:s(()=>[o(U,{description:"暂无订单记录","image-size":80})]),default:s(()=>[o(n,{type:"index",label:"ID",width:"60",align:"center"}),o(n,{prop:"goodsTitle",label:"商品标题","min-width":"200"},{default:s(({row:e})=>[p(c(e.goodsTitle||"-"),1)]),_:1}),o(n,{prop:"orderId",label:"订单ID",width:"180"},{default:s(({row:e})=>[r("span",ne,c(e.orderId||"-"),1)]),_:1}),o(n,{prop:"buyerUserId",label:"买家ID",width:"120"},{default:s(({row:e})=>[p(c(e.buyerUserId||"-"),1)]),_:1}),o(n,{prop:"buyerUserName",label:"买家名称",width:"120"},{default:s(({row:e})=>[p(c(e.buyerUserName||"-"),1)]),_:1}),o(n,{prop:"content",label:"发货内容","min-width":"200"},{default:s(({row:e})=>[r("div",re,c(e.content||"-"),1)]),_:1}),o(n,{prop:"state",label:"自动发货结果",width:"120",align:"center"},{default:s(({row:e})=>[o(x,{type:D(e.state),size:"small"},{default:s(()=>[p(c(N(e.state)),1)]),_:2},1032,["type"])]),_:1}),o(n,{prop:"orderState",label:"确认发货",width:"100",align:"center"},{default:s(({row:e})=>[o(x,{type:e.orderState===1?"success":"info",size:"small"},{default:s(()=>[p(c(e.orderState===1?"已确认":"未确认"),1)]),_:2},1032,["type"])]),_:1}),o(n,{prop:"createTime",label:"发货时间",width:"180"},{default:s(({row:e})=>[p(c(C(e.createTime)),1)]),_:1}),o(n,{label:"操作",width:"120",align:"center",fixed:"right"},{default:s(({row:e})=>[o(E,{type:"primary",size:"small",disabled:!e.orderId||e.orderState===1,onClick:ue=>A(e)},{default:s(()=>[...t[6]||(t[6]=[p(" 确认收货 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"]),_.value>0?(v(),b("div",de,[o(R,{"current-page":m.value,"onUpdate:currentPage":t[1]||(t[1]=e=>m.value=e),"page-size":y.value,"onUpdate:pageSize":t[2]||(t[2]=e=>y.value=e),"page-sizes":[10,20,50,100],total:_.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:k,onCurrentChange:T},null,8,["current-page","page-size","total"])])):W("",!0)])),[[j,w.value]])]),_:1})])}}}),ve=Z(ce,[["__scopeId","data-v-d3abdcd2"]]);export{ve as default};
