import{r as q,g as ae}from"./account-BM0RHrlO.js";import{g as le,u as se}from"./goods-DUkgtAex.js";import{a as _,b as f,s as M}from"./index-B9A6kdhu.js";import{G as ne}from"./GoodsDetailDialog-CnLvQ_-U.js";import{d as ie,r as c,m as ue,c as v,h as s,e as l,f as n,g as u,F as N,p as U,w as de,b as re,l as P,t as y,j as g,i as $,o as r,q as ce,_ as ve}from"./index-udmZ-1w9.js";function me(h){return q({url:"/auto-delivery-config/save",method:"POST",data:h})}function pe(h){return q({url:"/auto-delivery-config/get",method:"POST",data:h})}const ye={class:"auto-delivery-page"},_e={class:"page-header"},fe={class:"header-actions"},ge={class:"content-container"},he={class:"goods-panel"},xe={class:"card-header"},we={class:"card-subtitle"},Ce={class:"goods-list"},De=["id","onClick"],Ie={class:"goods-info"},Ge={class:"goods-title"},Ve={class:"goods-meta"},Ae={class:"goods-price"},be={key:0,class:"empty-goods"},ke={class:"config-panel"},Oe={class:"card-header"},Se={key:1,class:"card-subtitle"},Te={key:0,class:"config-form"},Ee={class:"switch-label"},Me={class:"save-config-container"},Ne={key:0,class:"last-update-time"},Ue={key:1,class:"empty-config"},Pe=ie({__name:"index",setup(h){const x=c(!1),I=c(!1),w=c([]),i=c(null),m=c([]),a=c(null),p=c(null),G=c(!1),A=c(""),d=c({type:1,autoDeliveryContent:""}),z=t=>t?t.replace("T"," ").substring(0,19):"-",B=async()=>{try{const t=await ae();(t.code===0||t.code===200)&&(w.value=t.data?.accounts||[],w.value.length>0&&!i.value&&(i.value=w.value[0]?.id||null,b()))}catch(t){_("加载账号列表失败: "+t.message)}},b=async()=>{if(!i.value){f("请先选择账号");return}x.value=!0;try{const t={xianyuAccountId:i.value,pageNum:1,pageSize:100},e=await le(t);if(e.code===0||e.code===200)m.value=e.data?.itemsWithConfig||[],m.value.length>0&&!a.value&&m.value.length>0&&k(m.value[0]);else throw new Error(e.msg||"获取商品列表失败")}catch(t){_("加载商品列表失败: "+t.message),m.value=[]}finally{x.value=!1}},L=()=>{a.value=null,p.value=null,b()},k=async t=>{a.value=t,await F()},F=async()=>{if(!(!a.value||!i.value))try{const t={xianyuAccountId:i.value,xyGoodsId:a.value.item.xyGoodId},e=await pe(t);if(e.code===0||e.code===200)p.value=e.data||null,e.data?(d.value.type=e.data.type,d.value.autoDeliveryContent=e.data.autoDeliveryContent||""):(d.value.type=1,d.value.autoDeliveryContent="");else throw new Error(e.msg||"获取配置失败")}catch(t){_("加载配置失败: "+t.message),p.value=null}},j=async()=>{if(!a.value||!i.value){f("请先选择商品");return}if(!d.value.autoDeliveryContent.trim()){f("请输入自动发货内容");return}I.value=!0;try{const t={xianyuAccountId:i.value,xianyuGoodsId:a.value.item.id,xyGoodsId:a.value.item.xyGoodId,type:d.value.type,autoDeliveryContent:d.value.autoDeliveryContent.trim()},e=await me(t);if(e.code===0||e.code===200)M("保存配置成功"),p.value=e.data||null;else throw new Error(e.msg||"保存配置失败")}catch(t){_("保存配置失败: "+t.message)}finally{I.value=!1}},W=t=>({0:"success",1:"info",2:"warning"})[t]||"info",H=t=>({0:"在售",1:"已下架",2:"已售出"})[t]||"未知",J=t=>t?`¥${t}`:"-",K=()=>{if(!a.value||!i.value){f("请先选择商品");return}A.value=a.value.item.xyGoodId,G.value=!0},Q=async t=>{if(!a.value||!i.value){f("请先选择商品");return}try{const e=await se({xianyuAccountId:i.value,xyGoodsId:a.value.item.xyGoodId,xianyuAutoDeliveryOn:t?1:0});if(e.code===0||e.code===200){M(`自动发货${t?"开启":"关闭"}成功`),a.value&&(a.value.xianyuAutoDeliveryOn=t?1:0);const C=m.value.find(V=>V.item.xyGoodId===a.value?.item.xyGoodId);C&&(C.xianyuAutoDeliveryOn=t?1:0)}else throw new Error(e.msg||"操作失败")}catch(e){_("操作失败: "+e.message),a.value&&(a.value.xianyuAutoDeliveryOn=t?0:1)}};return ue(()=>{B()}),(t,e)=>{const C=u("el-option"),V=u("el-select"),R=u("el-image"),X=u("el-tag"),O=u("el-empty"),S=u("el-card"),T=u("el-button"),Y=u("el-switch"),D=u("el-form-item"),E=u("el-radio"),Z=u("el-radio-group"),ee=u("el-input"),te=u("el-form"),oe=re("loading");return r(),v("div",ye,[s("div",_e,[e[5]||(e[5]=s("h1",{class:"page-title"},"自动发货配置",-1)),s("div",fe,[l(V,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),placeholder:"选择账号",style:{width:"200px"},onChange:L},{default:n(()=>[(r(!0),v(N,null,U(w.value,o=>(r(),$(C,{key:o.id,label:o.accountNote||o.unb,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),s("div",ge,[s("div",he,[l(S,{class:"goods-card"},{header:n(()=>[s("div",xe,[e[6]||(e[6]=s("span",{class:"card-title"},"商品列表",-1)),s("span",we,"共 "+y(m.value.length)+" 件商品",1)])]),default:n(()=>[de((r(),v("div",Ce,[(r(!0),v(N,null,U(m.value,o=>(r(),v("div",{key:o.item.xyGoodId,id:`goods-item-${o.item.id}-${Math.random().toString(36).substr(2,9)}`,class:ce(["goods-item",{active:a.value?.item.xyGoodId===o.item.xyGoodId}]),onClick:$e=>k(o)},[l(R,{src:o.item.coverPic,fit:"cover",class:"goods-image"},null,8,["src"]),s("div",Ie,[s("div",Ge,y(o.item.title),1),s("div",Ve,[s("span",Ae,y(J(o.item.soldPrice)),1),l(X,{type:W(o.item.status),size:"small"},{default:n(()=>[g(y(H(o.item.status)),1)]),_:2},1032,["type"])])])],10,De))),128)),m.value.length===0&&!x.value?(r(),v("div",be,[l(O,{description:"暂无商品"})])):P("",!0)])),[[oe,x.value]])]),_:1})]),s("div",ke,[l(S,{class:"config-card"},{header:n(()=>[s("div",Oe,[e[8]||(e[8]=s("span",{class:"card-title"},"自动发货配置",-1)),a.value?(r(),$(T,{key:0,type:"primary",size:"small",onClick:K},{default:n(()=>[...e[7]||(e[7]=[g(" 查看商品详情 ",-1)])]),_:1})):(r(),v("span",Se," 请选择商品 "))])]),default:n(()=>[a.value?(r(),v("div",Te,[l(te,{model:d.value,"label-width":"100px"},{default:n(()=>[l(D,{label:"自动发货"},{default:n(()=>[l(Y,{modelValue:a.value.xianyuAutoDeliveryOn,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.xianyuAutoDeliveryOn=o),"active-value":1,"inactive-value":0,onChange:Q},null,8,["modelValue"]),s("span",Ee,y(a.value.xianyuAutoDeliveryOn===1?"已开启":"已关闭"),1)]),_:1}),l(D,{label:"发货类型"},{default:n(()=>[l(Z,{modelValue:d.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.type=o)},{default:n(()=>[l(E,{value:1},{default:n(()=>[...e[9]||(e[9]=[g("文本内容",-1)])]),_:1}),l(E,{value:2},{default:n(()=>[...e[10]||(e[10]=[g("自定义",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(D,{label:"发货内容"},{default:n(()=>[l(ee,{modelValue:d.value.autoDeliveryContent,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.autoDeliveryContent=o),type:"textarea",rows:8,placeholder:"请输入自动发货内容，买家下单后将自动发送此内容",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(D,null,{default:n(()=>[s("div",Me,[l(T,{type:"primary",loading:I.value,onClick:j},{default:n(()=>[...e[11]||(e[11]=[g(" 保存配置 ",-1)])]),_:1},8,["loading"]),p.value?(r(),v("span",Ne," 上次更新: "+y(z(p.value.updateTime)),1)):P("",!0)])]),_:1})]),_:1},8,["model"])])):(r(),v("div",Ue,[l(O,{description:"请选择左侧商品进行配置"})]))]),_:1})])]),l(ne,{modelValue:G.value,"onUpdate:modelValue":e[4]||(e[4]=o=>G.value=o),"goods-id":A.value,"account-id":i.value},null,8,["modelValue","goods-id","account-id"])])}}}),je=ve(Pe,[["__scopeId","data-v-976d2cab"]]);export{je as default};
