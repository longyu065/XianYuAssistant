import{r as z,g as $}from"./account-CfoO5zdO.js";import{a as C,b as G,s as L}from"./index-OiMc3YKb.js";import{d as H,r as m,m as J,n as K,c,h as s,e as h,f as i,g as A,w as T,b as Q,i as x,l as S,F as B,p as V,j as I,t as d,o as n,q as O,_ as W}from"./index-DAN5Cn3s.js";function X(_){return z({url:"/websocket/status",method:"POST",data:{xianyuAccountId:_}})}function Y(_){return z({url:"/websocket/start",method:"POST",data:{xianyuAccountId:_}})}function Z(_){return z({url:"/websocket/stop",method:"POST",data:{xianyuAccountId:_}})}const ee={class:"connection-page"},te={class:"connection-container"},se={class:"account-list"},ae=["onClick"],ne={class:"account-avatar"},oe={class:"account-info"},le={class:"account-name"},ce={class:"account-id"},ie={key:0,class:"empty-state"},re={key:1,class:"status-content"},de={key:0,class:"status-card"},ue={class:"status-header"},ve={class:"status-details"},_e={class:"detail-item"},me={class:"detail-value"},pe={class:"detail-item"},ge={class:"detail-value"},fe={class:"action-buttons"},he={class:"logs-section"},ye={class:"logs-container"},we={class:"log-time"},ke={class:"log-message"},Ce={key:0,class:"log-empty"},Ae=H({__name:"index",setup(_){const y=m(!1),w=m([]),a=m(null),u=m(null),v=m(!1),p=m([]);let g=null;const P=async()=>{y.value=!0;try{const e=await $();if(e.code===0||e.code===200)w.value=e.data?.accounts||[];else throw new Error(e.msg||"èŽ·å–è´¦å·åˆ—è¡¨å¤±è´¥")}catch(e){C("åŠ è½½è´¦å·åˆ—è¡¨å¤±è´¥: "+e.message),w.value=[]}finally{y.value=!1}},q=e=>{a.value=e,f(e),g&&clearInterval(g),g=window.setInterval(()=>{a.value&&f(a.value,!0)},5e3)},f=async(e,t=!1)=>{t||(v.value=!0);try{const o=await X(e);if(o.code===0||o.code===200)u.value=o.data,t||r("çŠ¶æ€å·²æ›´æ–°");else throw new Error(o.msg||"èŽ·å–è¿žæŽ¥çŠ¶æ€å¤±è´¥")}catch(o){t||(C("åŠ è½½è¿žæŽ¥çŠ¶æ€å¤±è´¥: "+o.message),r("åŠ è½½çŠ¶æ€å¤±è´¥: "+o.message,!0))}finally{v.value=!1}},F=async()=>{if(a.value){v.value=!0,r("æ­£åœ¨å¯åŠ¨è¿žæŽ¥...");try{const e=await Y(a.value);if(e.code===0||e.code===200)L("è¿žæŽ¥å¯åŠ¨æˆåŠŸ"),r("è¿žæŽ¥å¯åŠ¨æˆåŠŸ"),await f(a.value);else throw new Error(e.msg||"å¯åŠ¨è¿žæŽ¥å¤±è´¥")}catch(e){C("å¯åŠ¨è¿žæŽ¥å¤±è´¥: "+e.message),r("å¯åŠ¨è¿žæŽ¥å¤±è´¥: "+e.message,!0)}finally{v.value=!1}}},j=async()=>{if(a.value){v.value=!0,r("æ­£åœ¨æ–­å¼€è¿žæŽ¥...");try{const e=await Z(a.value);if(e.code===0||e.code===200)L("è¿žæŽ¥å·²æ–­å¼€"),r("è¿žæŽ¥å·²æ–­å¼€"),await f(a.value);else throw new Error(e.msg||"æ–­å¼€è¿žæŽ¥å¤±è´¥")}catch(e){C("æ–­å¼€è¿žæŽ¥å¤±è´¥: "+e.message),r("æ–­å¼€è¿žæŽ¥å¤±è´¥: "+e.message,!0)}finally{v.value=!1}}},M=()=>{a.value&&(f(a.value),G("çŠ¶æ€å·²åˆ·æ–°"))},r=(e,t=!1)=>{const k=new Date().toLocaleTimeString();p.value.push({time:k,message:e,isError:t}),p.value.length>50&&p.value.shift()},E=e=>e.accountNote||e.unb||"æœªå‘½åè´¦å·",R=e=>E(e).charAt(0);return J(()=>{P()}),K(()=>{g&&clearInterval(g)}),(e,t)=>{const o=A("el-empty"),k=A("el-card"),U=A("el-tag"),b=A("el-button"),D=Q("loading");return n(),c("div",ee,[t[10]||(t[10]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"è¿žæŽ¥ç®¡ç†")],-1)),s("div",te,[h(k,{class:"account-panel"},{header:i(()=>[...t[0]||(t[0]=[s("div",{class:"panel-header"},[s("span",{class:"panel-title"},"é—²é±¼è´¦å·")],-1)])]),default:i(()=>[T((n(),c("div",se,[(n(!0),c(B,null,V(w.value,l=>(n(),c("div",{key:l.id,class:O(["account-item",{active:a.value===l.id}]),onClick:N=>q(l.id)},[s("div",ne,d(R(l)),1),s("div",oe,[s("div",le,d(E(l)),1),s("div",ce,"ID: "+d(l.id),1)])],10,ae))),128)),!y.value&&w.value.length===0?(n(),x(o,{key:0,description:"æš‚æ— è´¦å·æ•°æ®","image-size":80})):S("",!0)])),[[D,y.value]])]),_:1}),h(k,{class:"status-panel"},{header:i(()=>[...t[1]||(t[1]=[s("div",{class:"panel-header"},[s("span",{class:"panel-title"},"è¿žæŽ¥çŠ¶æ€")],-1)])]),default:i(()=>[a.value?T((n(),c("div",re,[u.value?(n(),c("div",de,[s("div",ue,[t[3]||(t[3]=s("h3",{class:"status-title"},"è¿žæŽ¥ä¿¡æ¯",-1)),h(U,{type:u.value.connected?"success":"danger",size:"large",effect:"dark"},{default:i(()=>[I(d(u.value.connected?"å·²è¿žæŽ¥":"æœªè¿žæŽ¥"),1)]),_:1},8,["type"])]),s("div",ve,[s("div",_e,[t[4]||(t[4]=s("span",{class:"detail-label"},"è´¦å·ID",-1)),s("span",me,d(u.value.xianyuAccountId),1)]),s("div",pe,[t[5]||(t[5]=s("span",{class:"detail-label"},"è¿žæŽ¥çŠ¶æ€",-1)),s("span",ge,d(u.value.status),1)])])])):S("",!0),s("div",fe,[u.value?.connected?(n(),x(b,{key:0,type:"danger",size:"large",onClick:j},{default:i(()=>[...t[6]||(t[6]=[I(" æ–­å¼€è¿žæŽ¥ ",-1)])]),_:1})):(n(),x(b,{key:1,type:"primary",size:"large",onClick:F},{default:i(()=>[...t[7]||(t[7]=[I(" å¯åŠ¨è¿žæŽ¥ ",-1)])]),_:1})),h(b,{size:"large",onClick:M},{default:i(()=>[...t[8]||(t[8]=[I(" åˆ·æ–°çŠ¶æ€ ",-1)])]),_:1})]),s("div",he,[t[9]||(t[9]=s("div",{class:"logs-header"},"æ“ä½œæ—¥å¿—",-1)),s("div",ye,[(n(!0),c(B,null,V(p.value,(l,N)=>(n(),c("div",{key:N,class:O(["log-entry",{"log-error":l.isError}])},[s("span",we,"["+d(l.time)+"]",1),s("span",ke,d(l.message),1)],2))),128)),p.value.length===0?(n(),c("div",Ce," æš‚æ— æ—¥å¿—è®°å½• ")):S("",!0)])])])),[[D,v.value]]):(n(),c("div",ie,[h(o,{description:"è¯·é€‰æ‹©ä¸€ä¸ªè´¦å·æŸ¥çœ‹è¿žæŽ¥çŠ¶æ€","image-size":100},{image:i(()=>[...t[2]||(t[2]=[s("div",{class:"empty-icon"},"ðŸ”—",-1)])]),_:1})]))]),_:1})])])}}}),Se=W(Ae,[["__scopeId","data-v-80a3d918"]]);export{Se as default};
