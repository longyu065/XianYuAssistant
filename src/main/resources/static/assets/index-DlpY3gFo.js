import{g as X,e as D,h as Y,s as _,a as Z}from"./index-BTFSt2fU.js";import{g as ee,d as te,u as ae,a as oe,r as le}from"./goods-Bzsuu9Qq.js";import{G as se}from"./GoodsDetailDialog-DIkdK50B.js";import{d as ne,r as i,x as ie,c as S,i as u,b as o,g as s,h as r,F as re,j as de,m as g,w as ue,e as ce,f as O,t as h,o as w,_ as pe}from"./index-7CieyMQU.js";import"./request-DTdiWb_T.js";const ve={class:"goods-page"},ge={class:"page-header"},me={class:"header-actions"},fe={class:"card-header"},ye={class:"card-subtitle"},_e={class:"goods-id"},he={class:"goods-price"},we={class:"pagination-container"},xe=ne({__name:"index",setup(be){const x=i(!1),b=i(!1),m=i([]),n=i(null),f=i(""),C=i([]),p=i(1),G=i(20),A=i(0),I=i(!1),V=i(""),R=async()=>{try{const e=await X();(e.code===0||e.code===200)&&(m.value=e.data?.accounts||[],m.value.length>0&&!n.value&&(n.value=m.value[0]?.id||null,c()))}catch(e){console.error("加载账号列表失败:",e)}},c=async()=>{if(!n.value){D("请先选择账号");return}x.value=!0;try{const e={xianyuAccountId:n.value,pageNum:p.value,pageSize:G.value};f.value!==""&&(e.status=parseInt(f.value));const t=await ee(e);(t.code===0||t.code===200)&&(C.value=t.data?.itemsWithConfig||[],A.value=t.data?.totalCount||0)}catch(e){console.error("加载商品列表失败:",e),C.value=[]}finally{x.value=!1}},P=async()=>{if(!n.value){D("请先选择账号");return}b.value=!0;try{const e=await le(n.value);(e.code===0||e.code===200)&&(e.data&&e.data.success?(_("商品数据刷新成功"),await c()):Z(e.data?.message||"刷新商品数据失败"))}catch(e){console.error("刷新商品数据失败:",e)}finally{b.value=!1}},$=()=>{p.value=1,c()},E=()=>{p.value=1,c()},M=e=>{p.value=e,c()},N=e=>{V.value=e,I.value=!0},T=async(e,t)=>{if(!n.value){D("请先选择账号");return}try{await Y(`确定要删除商品 "${t}" 吗？此操作不可恢复。`,"删除确认");const l=await te({xianyuAccountId:n.value,xyGoodsId:e});if(l.code===0||l.code===200)_("商品删除成功"),await c();else throw new Error(l.msg||"删除失败")}catch(l){if(l==="cancel")return;console.error("删除失败:",l)}},B=async(e,t)=>{if(n.value)try{const l=await ae({xianyuAccountId:n.value,xyGoodsId:e.item.xyGoodId,xianyuAutoDeliveryOn:t?1:0});if(l.code===0||l.code===200)_(`自动发货${t?"开启":"关闭"}成功`),e.xianyuAutoDeliveryOn=t?1:0;else throw new Error(l.msg||"操作失败")}catch(l){console.error("操作失败:",l),e.xianyuAutoDeliveryOn=t?0:1}},F=async(e,t)=>{if(n.value)try{const l=await oe({xianyuAccountId:n.value,xyGoodsId:e.item.xyGoodId,xianyuAutoReplyOn:t?1:0});if(l.code===0||l.code===200)_(`自动回复${t?"开启":"关闭"}成功`),e.xianyuAutoReplyOn=t?1:0;else throw new Error(l.msg||"操作失败")}catch(l){console.error("操作失败:",l),e.xianyuAutoReplyOn=t?0:1}},L=e=>({0:"success",1:"info",2:"warning"})[e]||"info",U=e=>({0:"在售",1:"已下架",2:"已售出"})[e]||"未知",j=e=>e?`¥${e}`:"-";return ie(()=>{R()}),(e,t)=>{const l=r("el-option"),k=r("el-select"),y=r("el-button"),d=r("el-table-column"),W=r("el-image"),q=r("el-tag"),z=r("el-switch"),H=r("el-table"),J=r("el-pagination"),K=r("el-card"),Q=ce("loading");return w(),S("div",ve,[u("div",ge,[t[6]||(t[6]=u("h1",{class:"page-title"},"商品管理",-1)),u("div",me,[o(k,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),placeholder:"选择账号",style:{width:"200px"},onChange:$},{default:s(()=>[(w(!0),S(re,null,de(m.value,a=>(w(),O(l,{key:a.id,label:a.accountNote||a.unb,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(k,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"全部状态",style:{width:"150px"},clearable:"",onChange:E},{default:s(()=>[o(l,{label:"在售商品",value:"0"}),o(l,{label:"已下架",value:"1"}),o(l,{label:"已售出",value:"2"})]),_:1},8,["modelValue"]),o(y,{onClick:c},{default:s(()=>[...t[4]||(t[4]=[g("刷新列表",-1)])]),_:1}),o(y,{type:"primary",loading:b.value,onClick:P},{default:s(()=>[...t[5]||(t[5]=[g(" 同步闲鱼商品 ",-1)])]),_:1},8,["loading"])])]),o(K,{class:"goods-card"},{header:s(()=>[u("div",fe,[t[7]||(t[7]=u("span",{class:"card-title"},"商品列表",-1)),u("span",ye,"共 "+h(A.value)+" 件商品",1)])]),default:s(()=>[ue((w(),O(H,{data:C.value,stripe:"",style:{width:"100%"},size:"small"},{default:s(()=>[o(d,{type:"index",label:"序号",width:"60",align:"center"}),o(d,{prop:"item.xyGoodId",label:"商品ID",width:"140"},{default:s(({row:a})=>[u("div",_e,h(a.item.xyGoodId),1)]),_:1}),o(d,{label:"商品图片",width:"80",align:"center"},{default:s(({row:a})=>[o(W,{src:a.item.coverPic,fit:"cover",class:"goods-image","preview-src-list":[a.item.coverPic]},null,8,["src","preview-src-list"])]),_:1}),o(d,{prop:"item.title",label:"商品标题","min-width":"200","show-overflow-tooltip":""}),o(d,{label:"价格",width:"100",align:"right"},{default:s(({row:a})=>[u("span",he,h(j(a.item.soldPrice)),1)]),_:1}),o(d,{label:"状态",width:"80"},{default:s(({row:a})=>[o(q,{type:L(a.item.status),size:"small"},{default:s(()=>[g(h(U(a.item.status)),1)]),_:2},1032,["type"])]),_:1}),o(d,{label:"自动发货",width:"80",align:"center"},{default:s(({row:a})=>[o(z,{"model-value":a.xianyuAutoDeliveryOn===1,onChange:v=>B(a,v),size:"small"},null,8,["model-value","onChange"])]),_:1}),o(d,{label:"自动回复",width:"80",align:"center"},{default:s(({row:a})=>[o(z,{"model-value":a.xianyuAutoReplyOn===1,onChange:v=>F(a,v),size:"small"},null,8,["model-value","onChange"])]),_:1}),o(d,{label:"操作",width:"150",align:"center",fixed:"right"},{default:s(({row:a})=>[o(y,{type:"primary",link:"",size:"small",onClick:v=>N(a.item.xyGoodId)},{default:s(()=>[...t[8]||(t[8]=[g(" 查看详情 ",-1)])]),_:1},8,["onClick"]),o(y,{type:"danger",link:"",size:"small",onClick:v=>T(a.item.xyGoodId,a.item.title)},{default:s(()=>[...t[9]||(t[9]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,x.value]]),u("div",we,[o(J,{"current-page":p.value,"onUpdate:currentPage":t[2]||(t[2]=a=>p.value=a),"page-size":G.value,total:A.value,layout:"total, prev, pager, next, jumper",onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),o(se,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=a=>I.value=a),"goods-id":V.value,"account-id":n.value,onRefresh:c},null,8,["modelValue","goods-id","account-id"])])}}}),Ve=pe(xe,[["__scopeId","data-v-05af6544"]]);export{Ve as default};
